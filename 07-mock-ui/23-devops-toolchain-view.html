<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FleetFlag - DevOps Toolchain Management (JointJS Pro)</title>
    
    <!-- JointJS CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jointjs/3.7.0/joint.min.css">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root {
            /* Brand Colors */
            --primary: #002c5f;
            --secondary: #00aad2;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #dc2626;
            
            /* DevOps Stage Colors */
            --plan-color: #7e57c2;
            --code-color: #26a69a;
            --build-color: #42a5f5;
            --test-color: #66bb6a;
            --release-color: #ffa726;
            --deploy-color: #ef5350;
            --operate-color: #ab47bc;
            --monitor-color: #29b6f6;
        }
        
        body {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            min-height: 100vh;
            color: #e2e8f0;
        }
        
        /* Glass-morphism Card */
        .glass-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.1);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }
        
        .glass-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 48px rgba(0, 170, 210, 0.15);
        }
        
        /* Tab Styles */
        .tab-button {
            position: relative;
            padding: 12px 24px;
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid rgba(148, 163, 184, 0.1);
            border-radius: 8px;
            color: #94a3b8;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .tab-button:hover {
            background: rgba(59, 130, 246, 0.1);
            border-color: rgba(59, 130, 246, 0.3);
            color: #60a5fa;
        }
        
        .tab-button.active {
            background: linear-gradient(135deg, #3b82f6 0%, #00aad2 100%);
            border-color: #3b82f6;
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        
        /* JointJS Paper Container */
        .joint-paper-container {
            width: 100%;
            height: 650px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            border: 1px solid rgba(148, 163, 184, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        /* Control Panel */
        .control-panel {
            position: absolute;
            top: 16px;
            right: 16px;
            z-index: 10;
            display: flex;
            gap: 8px;
        }
        
        .control-btn {
            width: 40px;
            height: 40px;
            background: rgba(30, 41, 59, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 8px;
            color: #94a3b8;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .control-btn:hover {
            background: rgba(59, 130, 246, 0.2);
            border-color: #3b82f6;
            color: #60a5fa;
        }
        
        /* Stats Card */
        .stat-card {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid rgba(148, 163, 184, 0.1);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #3b82f6;
            margin-bottom: 4px;
        }
        
        .stat-label {
            font-size: 12px;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Tool Card */
        .tool-card {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid rgba(148, 163, 184, 0.1);
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .tool-card:hover {
            transform: translateY(-4px);
            border-color: var(--secondary);
            box-shadow: 0 8px 24px rgba(0, 170, 210, 0.2);
        }
        
        .tool-icon {
            width: 48px;
            height: 48px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin: 0 auto 12px;
        }
        
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-active { background: rgba(16, 185, 129, 0.1); color: #10b981; }
        .status-warning { background: rgba(245, 158, 11, 0.1); color: #f59e0b; }
        .status-error { background: rgba(220, 38, 38, 0.1); color: #dc2626; }
        .status-inactive { background: rgba(107, 114, 128, 0.1); color: #6b7280; }
        
        /* Activity Log */
        .activity-log {
            max-height: 200px;
            overflow-y: auto;
            padding: 12px;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 8px;
        }
        
        .activity-item {
            display: flex;
            gap: 12px;
            padding: 8px;
            margin-bottom: 8px;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 6px;
            font-size: 13px;
        }
        
        .activity-time {
            color: #64748b;
            min-width: 50px;
        }
        
        .activity-text {
            color: #cbd5e1;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: rgba(30, 41, 59, 0.95);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 16px;
            padding: 32px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.3);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.5);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: rgba(59, 130, 246, 0.7);
        }
        
        /* Animation */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .pulse {
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .slide-in {
            animation: slideIn 0.5s ease-out;
        }
        
        /* JointJS Custom Element Styles */
        .joint-element text {
            font-family: 'Inter', sans-serif !important;
            font-weight: 600 !important;
        }
        
        .joint-link .connection {
            stroke-width: 3;
        }
    </style>
</head>
<body class="p-8">
    <!-- Header -->
    <div class="max-w-7xl mx-auto mb-8">
        <div class="flex items-center justify-between mb-6">
            <div>
                <h1 class="text-4xl font-bold text-white mb-2">
                    <i class="fas fa-project-diagram mr-3" style="color: #00aad2;"></i>
                    DevOps Toolchain Management
                </h1>
                <p class="text-slate-400">Professional Visualization with JointJS v3.7</p>
            </div>
            <div class="flex gap-3">
                <button onclick="exportData()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition">
                    <i class="fas fa-download mr-2"></i>Export JSON
                </button>
                <button onclick="exportSVG()" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition">
                    <i class="fas fa-file-image mr-2"></i>Export SVG
                </button>
            </div>
        </div>
        
        <!-- Stats Dashboard -->
        <div class="grid grid-cols-4 gap-4 mb-6">
            <div class="stat-card">
                <div class="stat-value">8</div>
                <div class="stat-label">DevOps Stages</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="total-tools">27</div>
                <div class="stat-label">Active Tools</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">2.5 min</div>
                <div class="stat-label">Avg Cycle Time</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">98.5%</div>
                <div class="stat-label">Success Rate</div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto">
        <!-- Tab Navigation -->
        <div class="flex gap-3 mb-6">
            <button class="tab-button active" onclick="switchTab('infinity')">
                <i class="fas fa-infinity mr-2"></i>Infinity Loop
            </button>
            <button class="tab-button" onclick="switchTab('pipeline')">
                <i class="fas fa-stream mr-2"></i>Horizontal Pipeline
            </button>
            <button class="tab-button" onclick="switchTab('hybrid')">
                <i class="fas fa-layer-group mr-2"></i>Hybrid Layers
            </button>
            <button class="tab-button" onclick="switchTab('toolchain')">
                <i class="fas fa-tools mr-2"></i>Toolchain Status
            </button>
        </div>

        <!-- Tab Content -->
        <div class="glass-card p-6">
            <!-- Tab 1: Infinity Loop View -->
            <div id="tab-infinity" class="tab-content">
                <div class="mb-4">
                    <h2 class="text-2xl font-bold text-white">
                        <i class="fas fa-infinity mr-2 text-purple-400"></i>
                        DevOps Infinity Loop
                    </h2>
                </div>
                <div class="joint-paper-container" id="paper-infinity">
                    <div class="control-panel">
                        <button class="control-btn" onclick="zoomIn('infinity')" title="Zoom In">
                            <i class="fas fa-search-plus"></i>
                        </button>
                        <button class="control-btn" onclick="zoomOut('infinity')" title="Zoom Out">
                            <i class="fas fa-search-minus"></i>
                        </button>
                        <button class="control-btn" onclick="resetZoom('infinity')" title="Reset View">
                            <i class="fas fa-compress"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Tab 2: Horizontal Pipeline View -->
            <div id="tab-pipeline" class="tab-content" style="display: none;">
                <div class="mb-4">
                    <h2 class="text-2xl font-bold text-white">
                        <i class="fas fa-stream mr-2 text-blue-400"></i>
                        Horizontal CI/CD Pipeline
                    </h2>
                </div>
                <div class="joint-paper-container" id="paper-pipeline">
                    <div class="control-panel">
                        <button class="control-btn" onclick="zoomIn('pipeline')" title="Zoom In">
                            <i class="fas fa-search-plus"></i>
                        </button>
                        <button class="control-btn" onclick="zoomOut('pipeline')" title="Zoom Out">
                            <i class="fas fa-search-minus"></i>
                        </button>
                        <button class="control-btn" onclick="resetZoom('pipeline')" title="Reset View">
                            <i class="fas fa-compress"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Tab 3: Hybrid Layers View -->
            <div id="tab-hybrid" class="tab-content" style="display: none;">
                <div class="mb-4">
                    <h2 class="text-2xl font-bold text-white">
                        <i class="fas fa-layer-group mr-2 text-indigo-400"></i>
                        Hybrid 3-Layer Architecture
                    </h2>
                </div>
                <div class="joint-paper-container" id="paper-hybrid">
                    <div class="control-panel">
                        <button class="control-btn" onclick="zoomIn('hybrid')" title="Zoom In">
                            <i class="fas fa-search-plus"></i>
                        </button>
                        <button class="control-btn" onclick="zoomOut('hybrid')" title="Zoom Out">
                            <i class="fas fa-search-minus"></i>
                        </button>
                        <button class="control-btn" onclick="resetZoom('hybrid')" title="Reset View">
                            <i class="fas fa-compress"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Tab 4: Toolchain Status View -->
            <div id="tab-toolchain" class="tab-content" style="display: none;">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-white mb-4">
                        <i class="fas fa-tools mr-2 text-amber-400"></i>
                        Toolchain Status Dashboard
                    </h2>
                    
                    <!-- Filter & Search -->
                    <div class="flex gap-4 mb-6">
                        <div class="flex gap-2">
                            <button class="status-badge status-active" onclick="filterTools('active')">
                                <i class="fas fa-circle pulse"></i>Active
                            </button>
                            <button class="status-badge status-warning" onclick="filterTools('warning')">
                                <i class="fas fa-exclamation-triangle"></i>Warning
                            </button>
                            <button class="status-badge status-error" onclick="filterTools('error')">
                                <i class="fas fa-times-circle"></i>Error
                            </button>
                            <button class="status-badge status-inactive" onclick="filterTools('inactive')">
                                <i class="fas fa-circle"></i>Inactive
                            </button>
                            <button class="px-3 py-1 bg-slate-700 hover:bg-slate-600 text-white rounded-lg text-xs" onclick="filterTools('all')">
                                Show All
                            </button>
                        </div>
                        <input type="text" id="tool-search" placeholder="Search tools..." 
                               class="flex-1 px-4 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-slate-400"
                               oninput="searchTools(this.value)">
                    </div>
                    
                    <!-- Tools Grid -->
                    <div id="tools-grid" class="grid grid-cols-4 gap-4 mb-6">
                        <!-- Tools will be generated by JavaScript -->
                    </div>
                    
                    <!-- Activity Log -->
                    <div class="glass-card p-6">
                        <h3 class="text-lg font-bold text-white mb-4">
                            <i class="fas fa-history mr-2"></i>Recent Activity
                        </h3>
                        <div id="activity-log" class="activity-log">
                            <!-- Activities will be generated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="flex items-center justify-between mb-6">
                <h3 id="modal-title" class="text-2xl font-bold text-white"></h3>
                <button onclick="closeModal()" class="text-slate-400 hover:text-white text-2xl">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="modal-body">
                <!-- Modal content will be inserted here -->
            </div>
        </div>
    </div>

    <!-- JointJS Dependencies (Same as 22-cicd-pipeline-detailed.html) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.6.0/backbone-min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jointjs/3.7.0/joint.min.js"></script>

    <script>
        // DevOps Data
        const devopsStages = [
            { id: 'plan', name: 'Plan', icon: 'clipboard-list', color: '#7e57c2', tools: ['Jira', 'Azure Boards', 'Asana'] },
            { id: 'code', name: 'Code', icon: 'code', color: '#26a69a', tools: ['Git', 'GitHub', 'GitLab'] },
            { id: 'build', name: 'Build', icon: 'hammer', color: '#42a5f5', tools: ['Maven', 'Gradle', 'npm'] },
            { id: 'test', name: 'Test', icon: 'vial', color: '#66bb6a', tools: ['JUnit', 'Selenium', 'Jest'] },
            { id: 'release', name: 'Release', icon: 'tag', color: '#ffa726', tools: ['Jenkins', 'GitLab CI', 'CircleCI'] },
            { id: 'deploy', name: 'Deploy', icon: 'rocket', color: '#ef5350', tools: ['Kubernetes', 'Docker', 'Terraform'] },
            { id: 'operate', name: 'Operate', icon: 'cogs', color: '#ab47bc', tools: ['Ansible', 'Puppet', 'Chef'] },
            { id: 'monitor', name: 'Monitor', icon: 'chart-line', color: '#29b6f6', tools: ['Prometheus', 'Grafana', 'Datadog'] }
        ];

        const toolchainTools = [
            { name: 'Jira', stage: 'Plan', icon: 'fa-clipboard-list', color: '#0052cc', status: 'active' },
            { name: 'Azure Boards', stage: 'Plan', icon: 'fa-microsoft', color: '#0078d4', status: 'active' },
            { name: 'Git', stage: 'Code', icon: 'fa-code-branch', color: '#f05032', status: 'active' },
            { name: 'GitHub', stage: 'Code', icon: 'fa-github', color: '#181717', status: 'active' },
            { name: 'GitLab', stage: 'Code', icon: 'fa-gitlab', color: '#fc6d26', status: 'warning' },
            { name: 'Maven', stage: 'Build', icon: 'fa-java', color: '#c71a36', status: 'active' },
            { name: 'Gradle', stage: 'Build', icon: 'fa-hammer', color: '#02303a', status: 'active' },
            { name: 'npm', stage: 'Build', icon: 'fa-npm', color: '#cb3837', status: 'active' },
            { name: 'JUnit', stage: 'Test', icon: 'fa-vial', color: '#25a162', status: 'active' },
            { name: 'Selenium', stage: 'Test', icon: 'fa-robot', color: '#43b02a', status: 'warning' },
            { name: 'Jest', stage: 'Test', icon: 'fa-js', color: '#c21325', status: 'active' },
            { name: 'Jenkins', stage: 'Release', icon: 'fa-server', color: '#d24939', status: 'active' },
            { name: 'GitLab CI', stage: 'Release', icon: 'fa-gitlab', color: '#fc6d26', status: 'active' },
            { name: 'CircleCI', stage: 'Release', icon: 'fa-circle', color: '#343434', status: 'error' },
            { name: 'Kubernetes', stage: 'Deploy', icon: 'fa-dharmachakra', color: '#326ce5', status: 'active' },
            { name: 'Docker', stage: 'Deploy', icon: 'fa-docker', color: '#2496ed', status: 'active' },
            { name: 'Terraform', stage: 'Deploy', icon: 'fa-layer-group', color: '#7b42bc', status: 'active' },
            { name: 'Ansible', stage: 'Operate', icon: 'fa-terminal', color: '#ee0000', status: 'active' },
            { name: 'Puppet', stage: 'Operate', icon: 'fa-paw', color: '#ffae1a', status: 'inactive' },
            { name: 'Chef', stage: 'Operate', icon: 'fa-utensils', color: '#f09820', status: 'inactive' },
            { name: 'Prometheus', stage: 'Monitor', icon: 'fa-chart-line', color: '#e6522c', status: 'active' },
            { name: 'Grafana', stage: 'Monitor', icon: 'fa-chart-area', color: '#f46800', status: 'active' },
            { name: 'Datadog', stage: 'Monitor', icon: 'fa-dog', color: '#632ca6', status: 'active' },
            { name: 'New Relic', stage: 'Monitor', icon: 'fa-tachometer-alt', color: '#008c99', status: 'warning' },
            { name: 'Splunk', stage: 'Monitor', icon: 'fa-database', color: '#000000', status: 'active' },
            { name: 'ELK Stack', stage: 'Monitor', icon: 'fa-search', color: '#005571', status: 'active' },
            { name: 'SonarQube', stage: 'Test', icon: 'fa-bug', color: '#4e9bcd', status: 'active' }
        ];

        // JointJS Graphs and Papers
        let graphs = {};
        let papers = {};
        let currentScale = { infinity: 1, pipeline: 1, hybrid: 1 };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            initInfinityLoop();
            initHorizontalPipeline();
            initHybridLayers();
            initToolchainStatus();
        });

        // Tab Switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.style.display = 'none');
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(`tab-${tabName}`).style.display = 'block';
            event.target.closest('.tab-button').classList.add('active');
        }

        // ============================================
        // TAB 1: INFINITY LOOP VIEW
        // ============================================
        function initInfinityLoop() {
            const graph = new joint.dia.Graph();
            graphs['infinity'] = graph;

            const paper = new joint.dia.Paper({
                el: document.getElementById('paper-infinity'),
                model: graph,
                width: '100%',
                height: 650,
                gridSize: 10,
                drawGrid: false,
                background: { color: '#ffffff' },
                interactive: { elementMove: false }
            });
            papers['infinity'] = paper;

            // Lemniscate (Infinity Loop) Parameters
            const centerX = 600;
            const centerY = 325;
            const a = 200;
            const b = 130;

            // Draw lemniscate path
            const pathData = [];
            for (let i = 0; i <= 100; i++) {
                const t = (i / 100) * 2 * Math.PI;
                const cos_t = Math.cos(t);
                const sin_t = Math.sin(t);
                const denominator = 1 + sin_t * sin_t;
                
                const x = centerX + (a * cos_t) / denominator;
                const y = centerY + (b * sin_t * cos_t) / denominator;
                
                pathData.push(i === 0 ? `M ${x} ${y}` : `L ${x} ${y}`);
            }

            const loopPath = new joint.shapes.standard.Path();
            loopPath.attr({
                body: {
                    d: pathData.join(' '),
                    fill: 'none',
                    stroke: '#3b82f6',
                    strokeWidth: 4,
                    strokeDasharray: '10,5',
                    opacity: 0.6
                }
            });
            loopPath.addTo(graph);

            // Place stages on lemniscate
            const positions = [];
            for (let i = 0; i < 8; i++) {
                const t = (i / 8) * 2 * Math.PI;
                const cos_t = Math.cos(t);
                const sin_t = Math.sin(t);
                const denominator = 1 + sin_t * sin_t;
                
                const x = centerX + (a * cos_t) / denominator - 60;
                const y = centerY + (b * sin_t * cos_t) / denominator - 40;
                
                positions.push({ x, y });
            }

            devopsStages.forEach((stage, index) => {
                const pos = positions[index];
                
                const rect = new joint.shapes.standard.Rectangle();
                rect.position(pos.x, pos.y);
                rect.resize(120, 80);
                rect.attr({
                    body: {
                        fill: stage.color,
                        stroke: '#ffffff',
                        strokeWidth: 3,
                        rx: 12,
                        ry: 12,
                        filter: { name: 'dropShadow', args: { dx: 0, dy: 3, blur: 8, color: 'rgba(0,0,0,0.3)' } }
                    },
                    label: {
                        text: stage.name,
                        fill: '#ffffff',
                        fontSize: 14,
                        fontWeight: 'bold',
                        fontFamily: 'Inter'
                    }
                });
                
                rect.stage = stage;
                rect.addTo(graph);
                
                // Click event
                paper.on('element:pointerclick', function(elementView) {
                    const element = elementView.model;
                    if (element.stage) {
                        showStageModal(element.stage);
                    }
                });
            });
        }

        // ============================================
        // TAB 2: HORIZONTAL PIPELINE VIEW
        // ============================================
        function initHorizontalPipeline() {
            const graph = new joint.dia.Graph();
            graphs['pipeline'] = graph;

            const paper = new joint.dia.Paper({
                el: document.getElementById('paper-pipeline'),
                model: graph,
                width: '100%',
                height: 650,
                gridSize: 10,
                drawGrid: false,
                background: { color: '#ffffff' },
                interactive: { elementMove: false }
            });
            papers['pipeline'] = paper;

            const startX = 50;
            const startY = 275;
            const spacing = 140;
            const boxWidth = 110;
            const boxHeight = 90;

            const elements = [];
            devopsStages.forEach((stage, index) => {
                const x = startX + index * spacing;
                
                const rect = new joint.shapes.standard.Rectangle();
                rect.position(x, startY);
                rect.resize(boxWidth, boxHeight);
                rect.attr({
                    body: {
                        fill: stage.color,
                        stroke: '#ffffff',
                        strokeWidth: 3,
                        rx: 12,
                        ry: 12,
                        filter: { name: 'dropShadow', args: { dx: 0, dy: 4, blur: 10, color: 'rgba(0,0,0,0.3)' } }
                    },
                    label: {
                        text: `${stage.name}\n\n${stage.tools.length} tools`,
                        fill: '#ffffff',
                        fontSize: 12,
                        fontWeight: 'bold',
                        fontFamily: 'Inter',
                        textVerticalAnchor: 'middle'
                    }
                });
                
                rect.stage = stage;
                elements.push(rect);
                rect.addTo(graph);

                // Add arrow
                if (index < 7) {
                    const link = new joint.shapes.standard.Link();
                    link.source({ id: rect.id });
                    link.target({ x: x + boxWidth + spacing / 2, y: startY + boxHeight / 2 });
                    link.attr({
                        line: {
                            stroke: '#3b82f6',
                            strokeWidth: 4,
                            targetMarker: {
                                type: 'path',
                                d: 'M 10 -5 L 0 0 L 10 5 Z',
                                fill: '#3b82f6'
                            }
                        }
                    });
                    link.addTo(graph);
                }
            });

            // Loop back
            const loopLink = new joint.shapes.standard.Link();
            loopLink.source({ id: elements[7].id });
            loopLink.target({ id: elements[0].id });
            loopLink.vertices([
                { x: startX + 7 * spacing + boxWidth / 2, y: startY + boxHeight + 70 },
                { x: startX + boxWidth / 2, y: startY + boxHeight + 70 }
            ]);
            loopLink.attr({
                line: {
                    stroke: '#8b5cf6',
                    strokeWidth: 3,
                    strokeDasharray: '8,4',
                    targetMarker: {
                        type: 'path',
                        d: 'M 10 -5 L 0 0 L 10 5 Z',
                        fill: '#8b5cf6'
                    }
                }
            });
            loopLink.labels([{
                attrs: {
                    text: {
                        text: 'Continuous Loop',
                        fill: '#8b5cf6',
                        fontSize: 12,
                        fontWeight: 'bold'
                    },
                    rect: {
                        fill: 'rgba(139, 92, 246, 0.15)',
                        stroke: '#8b5cf6',
                        strokeWidth: 1,
                        rx: 6,
                        ry: 6
                    }
                },
                position: 0.5
            }]);
            loopLink.addTo(graph);

            paper.on('element:pointerclick', function(elementView) {
                const element = elementView.model;
                if (element.stage) {
                    showStageModal(element.stage);
                }
            });
        }

        // ============================================
        // TAB 3: HYBRID LAYERS VIEW
        // ============================================
        function initHybridLayers() {
            const graph = new joint.dia.Graph();
            graphs['hybrid'] = graph;

            const paper = new joint.dia.Paper({
                el: document.getElementById('paper-hybrid'),
                model: graph,
                width: '100%',
                height: 650,
                gridSize: 10,
                drawGrid: false,
                background: { color: '#ffffff' },
                interactive: { elementMove: false }
            });
            papers['hybrid'] = paper;

            // Layer 1: Tool Groups (Top)
            const toolGroups = [
                { name: 'Planning', x: 80, y: 50, tools: 2 },
                { name: 'SCM', x: 310, y: 50, tools: 3 },
                { name: 'CI/CD', x: 540, y: 50, tools: 2 },
                { name: 'Monitoring', x: 770, y: 50, tools: 3 }
            ];

            toolGroups.forEach(group => {
                const rect = new joint.shapes.standard.Rectangle();
                rect.position(group.x, group.y);
                rect.resize(180, 80);
                rect.attr({
                    body: {
                        fill: 'rgba(59, 130, 246, 0.1)',
                        stroke: '#3b82f6',
                        strokeWidth: 2,
                        strokeDasharray: '5,3',
                        rx: 10,
                        ry: 10
                    },
                    label: {
                        text: `${group.name}\nTools (${group.tools})`,
                        fill: '#3b82f6',
                        fontSize: 13,
                        fontWeight: 'bold',
                        fontFamily: 'Inter'
                    }
                });
                rect.addTo(graph);
            });

            // Layer 2: Central Loop (Middle)
            const centerX = 600;
            const centerY = 350;
            const radius = 160;

            const pathData = [];
            for (let i = 0; i <= 100; i++) {
                const angle = (i / 100) * 2 * Math.PI;
                const x = centerX + radius * Math.cos(angle);
                const y = centerY + radius * Math.sin(angle);
                pathData.push(i === 0 ? `M ${x} ${y}` : `L ${x} ${y}`);
            }

            const circlePath = new joint.shapes.standard.Path();
            circlePath.attr({
                body: {
                    d: pathData.join(' ') + ' Z',
                    fill: 'none',
                    stroke: '#3b82f6',
                    strokeWidth: 3,
                    strokeDasharray: '10,5',
                    opacity: 0.5
                }
            });
            circlePath.addTo(graph);

            devopsStages.forEach((stage, index) => {
                const angle = (index / 8) * 2 * Math.PI - Math.PI / 2;
                const x = centerX + radius * Math.cos(angle) - 50;
                const y = centerY + radius * Math.sin(angle) - 50;

                const circle = new joint.shapes.standard.Circle();
                circle.position(x, y);
                circle.resize(100, 100);
                circle.attr({
                    body: {
                        fill: stage.color,
                        stroke: '#ffffff',
                        strokeWidth: 3,
                        filter: { name: 'dropShadow', args: { dx: 0, dy: 3, blur: 8, color: 'rgba(0,0,0,0.3)' } }
                    },
                    label: {
                        text: stage.name,
                        fill: '#ffffff',
                        fontSize: 12,
                        fontWeight: 'bold',
                        fontFamily: 'Inter'
                    }
                });
                
                circle.stage = stage;
                circle.addTo(graph);
            });

            // Layer 3: Infrastructure (Bottom)
            const infraTools = [
                { name: 'Kubernetes', x: 150, y: 570 },
                { name: 'Docker', x: 370, y: 570 },
                { name: 'Terraform', x: 590, y: 570 },
                { name: 'Ansible', x: 810, y: 570 }
            ];

            infraTools.forEach(tool => {
                const rect = new joint.shapes.standard.Rectangle();
                rect.position(tool.x, tool.y);
                rect.resize(140, 55);
                rect.attr({
                    body: {
                        fill: 'rgba(139, 92, 246, 0.15)',
                        stroke: '#8b5cf6',
                        strokeWidth: 2,
                        rx: 10,
                        ry: 10
                    },
                    label: {
                        text: tool.name,
                        fill: '#8b5cf6',
                        fontSize: 13,
                        fontWeight: 'bold',
                        fontFamily: 'Inter'
                    }
                });
                rect.addTo(graph);
            });

            paper.on('element:pointerclick', function(elementView) {
                const element = elementView.model;
                if (element.stage) {
                    showStageModal(element.stage);
                }
            });
        }

        // ============================================
        // TAB 4: TOOLCHAIN STATUS VIEW
        // ============================================
        function initToolchainStatus() {
            renderTools();
            startActivityLog();
        }

        function renderTools(filter = 'all') {
            const grid = document.getElementById('tools-grid');
            grid.innerHTML = '';

            const filteredTools = filter === 'all' 
                ? toolchainTools 
                : toolchainTools.filter(t => t.status === filter);

            filteredTools.forEach(tool => {
                const card = document.createElement('div');
                card.className = 'tool-card';
                card.innerHTML = `
                    <div class="tool-icon" style="background: ${tool.color}20; color: ${tool.color};">
                        <i class="fas ${tool.icon}"></i>
                    </div>
                    <div class="text-center">
                        <div class="font-bold text-white mb-1">${tool.name}</div>
                        <div class="text-xs text-slate-400 mb-2">${tool.stage}</div>
                        <span class="status-badge status-${tool.status}">
                            <i class="fas fa-circle ${tool.status === 'active' ? 'pulse' : ''}"></i>
                            ${tool.status}
                        </span>
                    </div>
                `;
                card.onclick = () => showToolModal(tool);
                grid.appendChild(card);
            });

            document.getElementById('total-tools').textContent = filteredTools.length;
        }

        function filterTools(status) {
            renderTools(status);
        }

        function searchTools(query) {
            const grid = document.getElementById('tools-grid');
            grid.innerHTML = '';

            const filtered = toolchainTools.filter(t => 
                t.name.toLowerCase().includes(query.toLowerCase()) ||
                t.stage.toLowerCase().includes(query.toLowerCase())
            );

            filtered.forEach(tool => {
                const card = document.createElement('div');
                card.className = 'tool-card';
                card.innerHTML = `
                    <div class="tool-icon" style="background: ${tool.color}20; color: ${tool.color};">
                        <i class="fas ${tool.icon}"></i>
                    </div>
                    <div class="text-center">
                        <div class="font-bold text-white mb-1">${tool.name}</div>
                        <div class="text-xs text-slate-400 mb-2">${tool.stage}</div>
                        <span class="status-badge status-${tool.status}">
                            <i class="fas fa-circle ${tool.status === 'active' ? 'pulse' : ''}"></i>
                            ${tool.status}
                        </span>
                    </div>
                `;
                card.onclick = () => showToolModal(tool);
                grid.appendChild(card);
            });
        }

        function startActivityLog() {
            const activities = [
                'Build completed successfully',
                'Tests passed (127/127)',
                'Deployment started',
                'Configuration updated',
                'Security scan completed',
                'Performance metrics collected',
                'Alert triggered: High CPU usage',
                'Rollback initiated'
            ];

            function addActivity() {
                const log = document.getElementById('activity-log');
                const time = new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
                const activity = activities[Math.floor(Math.random() * activities.length)];
                
                const item = document.createElement('div');
                item.className = 'activity-item slide-in';
                item.innerHTML = `
                    <div class="activity-time">${time}</div>
                    <div class="activity-text">${activity}</div>
                `;
                
                log.insertBefore(item, log.firstChild);
                
                while (log.children.length > 20) {
                    log.removeChild(log.lastChild);
                }
            }

            for (let i = 0; i < 5; i++) {
                setTimeout(addActivity, i * 500);
            }

            setInterval(addActivity, 3000);
        }

        // ============================================
        // ZOOM CONTROLS
        // ============================================
        function zoomIn(view) {
            if (papers[view]) {
                currentScale[view] *= 1.2;
                papers[view].scale(currentScale[view]);
            }
        }

        function zoomOut(view) {
            if (papers[view]) {
                currentScale[view] *= 0.8;
                papers[view].scale(currentScale[view]);
            }
        }

        function resetZoom(view) {
            if (papers[view]) {
                currentScale[view] = 1;
                papers[view].scale(1);
                papers[view].translate(0, 0);
            }
        }

        // ============================================
        // MODAL FUNCTIONS
        // ============================================
        function showStageModal(stage) {
            const modal = document.getElementById('modal');
            const title = document.getElementById('modal-title');
            const body = document.getElementById('modal-body');

            title.innerHTML = `<i class="fas fa-${stage.icon} mr-3" style="color: ${stage.color};"></i>${stage.name}`;
            body.innerHTML = `
                <div class="mb-6">
                    <div class="text-slate-400 mb-4">Associated Tools:</div>
                    <div class="grid grid-cols-3 gap-3">
                        ${stage.tools.map(tool => `
                            <div class="p-3 bg-slate-700 rounded-lg text-center">
                                <div class="font-bold text-white">${tool}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="text-sm text-slate-400">
                    <p><strong>Stage:</strong> ${stage.name}</p>
                    <p><strong>Tools Count:</strong> ${stage.tools.length}</p>
                    <p><strong>Status:</strong> <span class="text-green-400">Active</span></p>
                </div>
            `;

            modal.classList.add('active');
        }

        function showToolModal(tool) {
            const modal = document.getElementById('modal');
            const title = document.getElementById('modal-title');
            const body = document.getElementById('modal-body');

            title.innerHTML = `<i class="fas ${tool.icon} mr-3" style="color: ${tool.color};"></i>${tool.name}`;
            body.innerHTML = `
                <div class="mb-6">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <div class="text-slate-400 text-sm mb-2">Stage</div>
                            <div class="text-white font-bold">${tool.stage}</div>
                        </div>
                        <div>
                            <div class="text-slate-400 text-sm mb-2">Status</div>
                            <span class="status-badge status-${tool.status}">
                                <i class="fas fa-circle"></i>${tool.status}
                            </span>
                        </div>
                    </div>
                </div>
                <div class="text-sm text-slate-400">
                    <p class="mb-2"><strong>Last Activity:</strong> 2 minutes ago</p>
                    <p class="mb-2"><strong>Health Score:</strong> 98%</p>
                    <p><strong>Version:</strong> Latest</p>
                </div>
            `;

            modal.classList.add('active');
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') closeModal();
        });

        document.getElementById('modal').addEventListener('click', function(e) {
            if (e.target === this) closeModal();
        });

        // ============================================
        // EXPORT FUNCTIONS
        // ============================================
        function exportData() {
            const data = {
                stages: devopsStages,
                tools: toolchainTools,
                timestamp: new Date().toISOString()
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'devops-toolchain-data.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        function exportSVG() {
            const activeTab = document.querySelector('.tab-button.active').textContent.trim().split('\n')[0].toLowerCase();
            const viewName = Object.keys(papers).find(key => 
                document.querySelector(`#tab-${key}`).style.display !== 'none'
            );
            
            if (papers[viewName]) {
                const svg = papers[viewName].svg;
                const serializer = new XMLSerializer();
                const svgString = serializer.serializeToString(svg);
                
                const blob = new Blob([svgString], { type: 'image/svg+xml' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `devops-${viewName}.svg`;
                a.click();
                URL.revokeObjectURL(url);
            }
        }
    </script>
</body>
</html>
