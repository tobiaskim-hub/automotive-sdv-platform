<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FleetFlag - DevOps Toolchain Management (JointJS)</title>
    
    <!-- JointJS CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jointjs/3.7.0/joint.min.css">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- FontAwesome -->
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
        }

        .glass-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.1);
            border-radius: 12px;
        }

        .tab-button {
            padding: 12px 24px;
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid rgba(148, 163, 184, 0.1);
            border-radius: 8px;
            color: #94a3b8;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab-button:hover {
            background: rgba(59, 130, 246, 0.1);
            border-color: rgba(59, 130, 246, 0.3);
            color: #60a5fa;
        }

        .tab-button.active {
            background: linear-gradient(135deg, #3b82f6 0%, #00aad2 100%);
            border-color: #3b82f6;
            color: white;
        }

        .paper-container {
            background: #ffffff;
            border-radius: 12px;
            padding: 20px;
            min-height: 700px;
        }

        .control-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 8px;
            z-index: 10;
        }

        .control-btn {
            width: 40px;
            height: 40px;
            background: rgba(30, 41, 59, 0.9);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 8px;
            color: #94a3b8;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .control-btn:hover {
            background: rgba(59, 130, 246, 0.2);
            border-color: #3b82f6;
            color: #60a5fa;
        }

        .stat-card {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid rgba(148, 163, 184, 0.1);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #3b82f6;
        }

        .stat-label {
            font-size: 14px;
            color: #94a3b8;
            text-transform: uppercase;
        }
    </style>
</head>
<body class="p-8">
    <!-- Header -->
    <div class="max-w-[1400px] mx-auto mb-6">
        <div class="flex items-center justify-between mb-6">
            <div>
                <h1 class="text-4xl font-bold text-white mb-2">
                    <i class="fas fa-project-diagram mr-3" style="color: #00aad2;"></i>
                    DevOps Toolchain Management
                </h1>
                <p class="text-slate-400">Professional Visualization with JointJS v3.7</p>
            </div>
            <div class="flex gap-3">
                <button onclick="exportSVG()" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition">
                    <i class="fas fa-file-image mr-2"></i>Export SVG
                </button>
            </div>
        </div>
        
        <!-- Stats -->
        <div class="grid grid-cols-4 gap-4 mb-6">
            <div class="stat-card">
                <div class="stat-value">8</div>
                <div class="stat-label">DevOps Stages</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">27</div>
                <div class="stat-label">Active Tools</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">2.5 min</div>
                <div class="stat-label">Cycle Time</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">98.5%</div>
                <div class="stat-label">Success Rate</div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-[1400px] mx-auto">
        <!-- Tabs -->
        <div class="flex gap-3 mb-6">
            <button class="tab-button active" onclick="switchTab('infinity')">
                <i class="fas fa-infinity mr-2"></i>Infinity Loop
            </button>
            <button class="tab-button" onclick="switchTab('pipeline')">
                <i class="fas fa-stream mr-2"></i>Horizontal Pipeline
            </button>
            <button class="tab-button" onclick="switchTab('hybrid')">
                <i class="fas fa-layer-group mr-2"></i>Hybrid Layers
            </button>
        </div>

        <!-- Tab Contents -->
        <div class="glass-card p-6">
            <!-- Tab 1: Infinity Loop -->
            <div id="tab-infinity" class="tab-content">
                <h2 class="text-2xl font-bold text-white mb-4">
                    <i class="fas fa-infinity mr-2 text-purple-400"></i>
                    DevOps Infinity Loop
                </h2>
                <div class="paper-container relative">
                    <div class="control-panel">
                        <button class="control-btn" onclick="zoomIn('infinity')" title="Zoom In">
                            <i class="fas fa-search-plus"></i>
                        </button>
                        <button class="control-btn" onclick="zoomOut('infinity')" title="Zoom Out">
                            <i class="fas fa-search-minus"></i>
                        </button>
                        <button class="control-btn" onclick="resetView('infinity')" title="Reset">
                            <i class="fas fa-compress"></i>
                        </button>
                    </div>
                    <div id="paper-infinity"></div>
                </div>
            </div>

            <!-- Tab 2: Horizontal Pipeline -->
            <div id="tab-pipeline" class="tab-content" style="display: none;">
                <h2 class="text-2xl font-bold text-white mb-4">
                    <i class="fas fa-stream mr-2 text-blue-400"></i>
                    Horizontal CI/CD Pipeline
                </h2>
                <div class="paper-container relative">
                    <div class="control-panel">
                        <button class="control-btn" onclick="zoomIn('pipeline')" title="Zoom In">
                            <i class="fas fa-search-plus"></i>
                        </button>
                        <button class="control-btn" onclick="zoomOut('pipeline')" title="Zoom Out">
                            <i class="fas fa-search-minus"></i>
                        </button>
                        <button class="control-btn" onclick="resetView('pipeline')" title="Reset">
                            <i class="fas fa-compress"></i>
                        </button>
                    </div>
                    <div id="paper-pipeline"></div>
                </div>
            </div>

            <!-- Tab 3: Hybrid Layers -->
            <div id="tab-hybrid" class="tab-content" style="display: none;">
                <h2 class="text-2xl font-bold text-white mb-4">
                    <i class="fas fa-layer-group mr-2 text-indigo-400"></i>
                    Hybrid 3-Layer Architecture
                </h2>
                <div class="paper-container relative">
                    <div class="control-panel">
                        <button class="control-btn" onclick="zoomIn('hybrid')" title="Zoom In">
                            <i class="fas fa-search-plus"></i>
                        </button>
                        <button class="control-btn" onclick="zoomOut('hybrid')" title="Zoom Out">
                            <i class="fas fa-search-minus"></i>
                        </button>
                        <button class="control-btn" onclick="resetView('hybrid')" title="Reset">
                            <i class="fas fa-compress"></i>
                        </button>
                    </div>
                    <div id="paper-hybrid"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- JointJS Dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.6.0/backbone-min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jointjs/3.7.0/joint.min.js"></script>

    <script>
        // DevOps Stage Data
        const stages = [
            { id: 'plan', name: 'Plan', color: '#7e57c2', tools: ['Jira', 'Azure Boards'] },
            { id: 'code', name: 'Code', color: '#26a69a', tools: ['Git', 'GitHub'] },
            { id: 'build', name: 'Build', color: '#42a5f5', tools: ['Maven', 'npm'] },
            { id: 'test', name: 'Test', color: '#66bb6a', tools: ['JUnit', 'Jest'] },
            { id: 'release', name: 'Release', color: '#ffa726', tools: ['Jenkins', 'GitLab CI'] },
            { id: 'deploy', name: 'Deploy', color: '#ef5350', tools: ['Kubernetes', 'Docker'] },
            { id: 'operate', name: 'Operate', color: '#ab47bc', tools: ['Ansible', 'Puppet'] },
            { id: 'monitor', name: 'Monitor', color: '#29b6f6', tools: ['Prometheus', 'Grafana'] }
        ];

        // Global objects
        let graphs = {};
        let papers = {};
        let scales = { infinity: 1, pipeline: 1, hybrid: 1 };

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initInfinityLoop();
            initHorizontalPipeline();
            initHybridLayers();
        });

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(`tab-${tabName}`).style.display = 'block';
            event.target.classList.add('active');
        }

        // Helper: Create rounded rectangle
        function createBox(x, y, w, h, text, color) {
            return new joint.shapes.standard.Rectangle({
                position: { x, y },
                size: { width: w, height: h },
                attrs: {
                    body: {
                        fill: color,
                        stroke: '#ffffff',
                        strokeWidth: 3,
                        rx: 12,
                        ry: 12,
                        filter: { name: 'dropShadow', args: { dx: 0, dy: 3, blur: 8, color: 'rgba(0,0,0,0.3)' } }
                    },
                    label: {
                        text: text,
                        fill: '#ffffff',
                        fontSize: 14,
                        fontWeight: 'bold',
                        textAnchor: 'middle',
                        textVerticalAnchor: 'middle'
                    }
                }
            });
        }

        // Helper: Create circle
        function createCircle(x, y, size, text, color) {
            return new joint.shapes.standard.Circle({
                position: { x, y },
                size: { width: size, height: size },
                attrs: {
                    body: {
                        fill: color,
                        stroke: '#ffffff',
                        strokeWidth: 3,
                        filter: { name: 'dropShadow', args: { dx: 0, dy: 3, blur: 8, color: 'rgba(0,0,0,0.3)' } }
                    },
                    label: {
                        text: text,
                        fill: '#ffffff',
                        fontSize: 12,
                        fontWeight: 'bold',
                        textAnchor: 'middle',
                        textVerticalAnchor: 'middle'
                    }
                }
            });
        }

        // Helper: Create link
        function createLink(source, target, dashed = false) {
            return new joint.shapes.standard.Link({
                source: source,
                target: target,
                attrs: {
                    line: {
                        stroke: '#3b82f6',
                        strokeWidth: 3,
                        strokeDasharray: dashed ? '8,4' : 'none',
                        targetMarker: {
                            type: 'path',
                            d: 'M 10 -5 L 0 0 L 10 5 Z',
                            fill: '#3b82f6'
                        }
                    }
                },
                connector: { name: 'rounded' }
            });
        }

        // ==========================================
        // TAB 1: INFINITY LOOP
        // ==========================================
        function initInfinityLoop() {
            const graph = new joint.dia.Graph();
            graphs['infinity'] = graph;

            const paper = new joint.dia.Paper({
                el: document.getElementById('paper-infinity'),
                model: graph,
                width: 1300,
                height: 650,
                gridSize: 10,
                background: { color: '#ffffff' },
                interactive: false
            });
            papers['infinity'] = paper;

            // Lemniscate parameters
            const cx = 650, cy = 325;
            const a = 250, b = 150;

            // Draw infinity path
            const pathData = [];
            for (let i = 0; i <= 200; i++) {
                const t = (i / 200) * 2 * Math.PI;
                const cos_t = Math.cos(t);
                const sin_t = Math.sin(t);
                const denom = 1 + sin_t * sin_t;
                const x = cx + (a * cos_t) / denom;
                const y = cy + (b * sin_t * cos_t) / denom;
                pathData.push((i === 0 ? 'M' : 'L') + ` ${x} ${y}`);
            }

            const loopPath = new joint.shapes.standard.Path({
                attrs: {
                    body: {
                        d: pathData.join(' '),
                        fill: 'none',
                        stroke: '#3b82f6',
                        strokeWidth: 4,
                        strokeDasharray: '12,6',
                        opacity: 0.6
                    },
                    label: { text: '' }
                }
            });
            loopPath.addTo(graph);

            // Place stages on lemniscate
            stages.forEach((stage, i) => {
                const t = (i / 8) * 2 * Math.PI;
                const cos_t = Math.cos(t);
                const sin_t = Math.sin(t);
                const denom = 1 + sin_t * sin_t;
                const x = cx + (a * cos_t) / denom - 60;
                const y = cy + (b * sin_t * cos_t) / denom - 40;

                const box = createBox(x, y, 120, 80, stage.name, stage.color);
                box.addTo(graph);
            });
        }

        // ==========================================
        // TAB 2: HORIZONTAL PIPELINE
        // ==========================================
        function initHorizontalPipeline() {
            const graph = new joint.dia.Graph();
            graphs['pipeline'] = graph;

            const paper = new joint.dia.Paper({
                el: document.getElementById('paper-pipeline'),
                model: graph,
                width: 1300,
                height: 650,
                gridSize: 10,
                background: { color: '#ffffff' },
                interactive: false
            });
            papers['pipeline'] = paper;

            const startX = 50, startY = 280, spacing = 145, w = 120, h = 90;
            const boxes = [];

            // Create stage boxes
            stages.forEach((stage, i) => {
                const x = startX + i * spacing;
                const box = createBox(x, startY, w, h, `${stage.name}\n${stage.tools.length} tools`, stage.color);
                box.addTo(graph);
                boxes.push(box);

                // Add arrow to next stage
                if (i < 7) {
                    const link = createLink(
                        { id: box.id },
                        { x: x + w + spacing/2, y: startY + h/2 }
                    );
                    link.addTo(graph);
                }
            });

            // Loop back arrow
            const loopLink = createLink(
                { id: boxes[7].id },
                { id: boxes[0].id },
                true
            );
            loopLink.vertices([
                { x: startX + 7 * spacing + w/2, y: startY + h + 80 },
                { x: startX + w/2, y: startY + h + 80 }
            ]);
            loopLink.labels([{
                attrs: {
                    text: {
                        text: 'Continuous Loop',
                        fill: '#8b5cf6',
                        fontSize: 13,
                        fontWeight: 'bold'
                    },
                    rect: {
                        fill: 'rgba(139,92,246,0.1)',
                        stroke: '#8b5cf6',
                        strokeWidth: 1,
                        rx: 6
                    }
                },
                position: 0.5
            }]);
            loopLink.addTo(graph);
        }

        // ==========================================
        // TAB 3: HYBRID LAYERS
        // ==========================================
        function initHybridLayers() {
            const graph = new joint.dia.Graph();
            graphs['hybrid'] = graph;

            const paper = new joint.dia.Paper({
                el: document.getElementById('paper-hybrid'),
                model: graph,
                width: 1300,
                height: 650,
                gridSize: 10,
                background: { color: '#ffffff' },
                interactive: false
            });
            papers['hybrid'] = paper;

            // Layer 1: Tool Groups (Top)
            const toolGroups = [
                { x: 100, y: 50, w: 200, text: 'Planning Tools\n(2 tools)', color: '#7e57c2' },
                { x: 350, y: 50, w: 200, text: 'SCM Tools\n(3 tools)', color: '#26a69a' },
                { x: 600, y: 50, w: 200, text: 'CI/CD Tools\n(2 tools)', color: '#ffa726' },
                { x: 850, y: 50, w: 200, text: 'Monitoring\n(3 tools)', color: '#29b6f6' }
            ];

            toolGroups.forEach(g => {
                const box = new joint.shapes.standard.Rectangle({
                    position: { x: g.x, y: g.y },
                    size: { width: g.w, height: 80 },
                    attrs: {
                        body: {
                            fill: g.color + '20',
                            stroke: g.color,
                            strokeWidth: 2,
                            strokeDasharray: '6,3',
                            rx: 10
                        },
                        label: {
                            text: g.text,
                            fill: g.color,
                            fontSize: 13,
                            fontWeight: 'bold',
                            textAnchor: 'middle',
                            textVerticalAnchor: 'middle'
                        }
                    }
                });
                box.addTo(graph);
            });

            // Layer 2: Central Circle (DevOps Loop)
            const cx = 650, cy = 350, r = 180;

            // Draw circle path
            const circlePath = [];
            for (let i = 0; i <= 100; i++) {
                const angle = (i / 100) * 2 * Math.PI;
                const x = cx + r * Math.cos(angle);
                const y = cy + r * Math.sin(angle);
                circlePath.push((i === 0 ? 'M' : 'L') + ` ${x} ${y}`);
            }

            const circlePathShape = new joint.shapes.standard.Path({
                attrs: {
                    body: {
                        d: circlePath.join(' ') + ' Z',
                        fill: 'none',
                        stroke: '#3b82f6',
                        strokeWidth: 3,
                        strokeDasharray: '10,5',
                        opacity: 0.5
                    },
                    label: { text: '' }
                }
            });
            circlePathShape.addTo(graph);

            // Place stages in circle
            stages.forEach((stage, i) => {
                const angle = (i / 8) * 2 * Math.PI - Math.PI/2;
                const x = cx + r * Math.cos(angle) - 50;
                const y = cy + r * Math.sin(angle) - 50;

                const circle = createCircle(x, y, 100, stage.name, stage.color);
                circle.addTo(graph);
            });

            // Layer 3: Infrastructure (Bottom)
            const infraTools = [
                { x: 150, y: 580, text: 'Kubernetes' },
                { x: 400, y: 580, text: 'Docker' },
                { x: 650, y: 580, text: 'Terraform' },
                { x: 900, y: 580, text: 'Ansible' }
            ];

            infraTools.forEach(tool => {
                const box = new joint.shapes.standard.Rectangle({
                    position: { x: tool.x, y: tool.y },
                    size: { width: 150, height: 50 },
                    attrs: {
                        body: {
                            fill: '#8b5cf6',
                            stroke: '#6d28d9',
                            strokeWidth: 2,
                            rx: 10
                        },
                        label: {
                            text: tool.text,
                            fill: '#ffffff',
                            fontSize: 13,
                            fontWeight: 'bold',
                            textAnchor: 'middle',
                            textVerticalAnchor: 'middle'
                        }
                    }
                });
                box.addTo(graph);
            });
        }

        // ==========================================
        // ZOOM CONTROLS
        // ==========================================
        function zoomIn(view) {
            scales[view] *= 1.2;
            papers[view].scale(scales[view]);
        }

        function zoomOut(view) {
            scales[view] *= 0.8;
            papers[view].scale(scales[view]);
        }

        function resetView(view) {
            scales[view] = 1;
            papers[view].scale(1);
            papers[view].translate(0, 0);
        }

        // ==========================================
        // EXPORT
        // ==========================================
        function exportSVG() {
            const activeView = document.querySelector('.tab-content:not([style*="display: none"])').id.replace('tab-', '');
            const paper = papers[activeView];
            
            if (paper) {
                const svg = paper.svg;
                const serializer = new XMLSerializer();
                const svgString = serializer.serializeToString(svg);
                
                const blob = new Blob([svgString], { type: 'image/svg+xml' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `devops-${activeView}.svg`;
                a.click();
                URL.revokeObjectURL(url);
            }
        }
    </script>
</body>
</html>
