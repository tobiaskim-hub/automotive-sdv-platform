<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FleetFlag - V-Model & DevOps Integration</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        :root {
            --primary: #002c5f;
            --secondary: #00aad2;
            --danger: #dc2626;
            --warning: #f59e0b;
            --success: #10b981;
            --purple: #8b5cf6;
            --indigo: #6366f1;
        }

        body {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #f1f5f9;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        #v-model-container {
            width: 100%;
            height: 700px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 16px;
            position: relative;
            overflow: hidden;
        }

        .v-path {
            stroke: #002c5f;
            stroke-width: 5;
            fill: none;
            stroke-opacity: 0.8;
            filter: drop-shadow(0 4px 8px rgba(0, 44, 95, 0.5));
        }

        .v-path-right {
            stroke: #10b981;
            stroke-width: 5;
            fill: none;
            stroke-opacity: 0.8;
            filter: drop-shadow(0 4px 8px rgba(16, 185, 129, 0.5));
        }

        .devops-loop {
            stroke: #8b5cf6;
            stroke-width: 4;
            fill: none;
            stroke-opacity: 0.9;
            stroke-dasharray: 10, 5;
            filter: drop-shadow(0 4px 12px rgba(139, 92, 246, 0.6));
            animation: dash 2s linear infinite;
        }

        @keyframes dash {
            to {
                stroke-dashoffset: -30;
            }
        }

        .node-circle {
            cursor: pointer;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.4));
            transition: all 0.3s ease;
        }

        .node-circle:hover {
            filter: drop-shadow(0 6px 16px rgba(0, 170, 210, 0.8));
            transform: scale(1.1);
        }

        .node-label {
            font-size: 13px;
            font-weight: 600;
            fill: #fff;
            text-anchor: middle;
            pointer-events: none;
            text-shadow: 0 0 4px rgba(0, 0, 0, 0.9);
        }

        .node-sublabel {
            font-size: 10px;
            fill: #94a3b8;
            text-anchor: middle;
            pointer-events: none;
        }

        .sync-line {
            stroke: #f59e0b;
            stroke-width: 2;
            stroke-dasharray: 5, 5;
            stroke-opacity: 0.6;
            marker-end: url(#arrow-sync);
        }

        .sync-point {
            fill: #f59e0b;
            stroke: #fff;
            stroke-width: 2;
            filter: drop-shadow(0 2px 4px rgba(245, 158, 11, 0.5));
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; r: 8; }
            50% { opacity: 0.6; r: 12; }
        }

        .particle {
            fill: #fff;
            opacity: 0.9;
            filter: drop-shadow(0 0 4px rgba(255, 255, 255, 0.8));
        }

        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.95);
            color: #fff;
            padding: 16px 20px;
            border-radius: 12px;
            font-size: 13px;
            pointer-events: none;
            z-index: 1000;
            border: 2px solid rgba(0, 170, 210, 0.6);
            display: none;
            max-width: 320px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
        }

        .tooltip-title {
            font-size: 15px;
            font-weight: 700;
            margin-bottom: 8px;
            color: #00aad2;
        }

        .tooltip-row {
            display: flex;
            justify-content: space-between;
            margin: 4px 0;
            font-size: 12px;
        }

        .tooltip-label {
            color: #94a3b8;
        }

        .tooltip-value {
            color: #fff;
            font-weight: 600;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 8px;
        }

        .status-completed {
            background: rgba(16, 185, 129, 0.3);
            color: #10b981;
        }

        .status-inprogress {
            background: rgba(59, 130, 246, 0.3);
            color: #3b82f6;
        }

        .status-pending {
            background: rgba(156, 163, 175, 0.3);
            color: #9ca3af;
        }

        .legend-item {
            display: inline-flex;
            align-items: center;
            margin-right: 24px;
            font-size: 13px;
        }

        .legend-line {
            width: 40px;
            height: 4px;
            margin-right: 10px;
            border-radius: 2px;
        }

        .control-btn {
            background: rgba(0, 170, 210, 0.2);
            border: 1px solid rgba(0, 170, 210, 0.5);
            padding: 10px 18px;
            border-radius: 10px;
            color: #00aad2;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
        }

        .control-btn:hover {
            background: rgba(0, 170, 210, 0.4);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 170, 210, 0.3);
        }

        .control-btn.active {
            background: rgba(0, 170, 210, 0.6);
            border-color: #00aad2;
        }

        .kpi-value {
            font-size: 32px;
            font-weight: 700;
            line-height: 1;
        }

        .kpi-label {
            font-size: 13px;
            color: #94a3b8;
            margin-top: 4px;
        }

        .kpi-trend {
            font-size: 12px;
            margin-top: 4px;
        }

        .trend-up {
            color: #10b981;
        }

        .trend-down {
            color: #dc2626;
        }
    </style>
</head>
<body>
    <div class="max-w-[1800px] mx-auto">
        <!-- Header -->
        <div class="glass-card mb-6">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-3xl font-bold mb-2">
                        <i class="fas fa-project-diagram mr-3" style="color: var(--secondary);"></i>
                        V-Model & DevOps Integration Dashboard
                    </h1>
                    <p class="text-gray-400">ÌïòÎìúÏõ®Ïñ¥ Î¨ºÎ¶¨Ï†Å ÌùêÎ¶Ñ(Linear)Í≥º ÏÜåÌîÑÌä∏Ïõ®Ïñ¥ Î∞òÎ≥µÏ†Å ÌùêÎ¶Ñ(Cyclic) ÌÜµÌï© ÏãúÍ∞ÅÌôî</p>
                </div>
                <div class="text-right">
                    <div class="text-sm text-gray-400">Last Updated</div>
                    <div class="text-xl font-semibold text-blue-400" id="last-update">Ïã§ÏãúÍ∞Ñ</div>
                </div>
            </div>
        </div>

        <!-- KPI Cards -->
        <div class="grid grid-cols-5 gap-4 mb-6">
            <div class="glass-card">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="kpi-label">V-Model ÏßÑÌñâÎ•†</div>
                        <div class="kpi-value text-blue-400">68%</div>
                        <div class="kpi-trend trend-up">
                            <i class="fas fa-arrow-up"></i> +12% vs ÏßÄÎÇúÏ£º
                        </div>
                    </div>
                    <i class="fas fa-chart-line text-5xl text-blue-400 opacity-20"></i>
                </div>
            </div>

            <div class="glass-card">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="kpi-label">DevOps ÏàúÌôò ÏÜçÎèÑ</div>
                        <div class="kpi-value text-purple-400">47</div>
                        <div class="kpi-trend text-gray-400">
                            <i class="fas fa-sync"></i> builds/day
                        </div>
                    </div>
                    <i class="fas fa-infinity text-5xl text-purple-400 opacity-20"></i>
                </div>
            </div>

            <div class="glass-card">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="kpi-label">Sync Point ÌÜµÌï©</div>
                        <div class="kpi-value text-yellow-400">4/4</div>
                        <div class="kpi-trend trend-up">
                            <i class="fas fa-check-circle"></i> 100% ÏôÑÎ£å
                        </div>
                    </div>
                    <i class="fas fa-link text-5xl text-yellow-400 opacity-20"></i>
                </div>
            </div>

            <div class="glass-card">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="kpi-label">ÌèâÍ∑† CI/CD ÏãúÍ∞Ñ</div>
                        <div class="kpi-value text-green-400">12m</div>
                        <div class="kpi-trend trend-up">
                            <i class="fas fa-clock"></i> -3m vs Î™©Ìëú
                        </div>
                    </div>
                    <i class="fas fa-stopwatch text-5xl text-green-400 opacity-20"></i>
                </div>
            </div>

            <div class="glass-card">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="kpi-label">ÌÖåÏä§Ìä∏ Ïª§Î≤ÑÎ¶¨ÏßÄ</div>
                        <div class="kpi-value text-indigo-400">94%</div>
                        <div class="kpi-trend trend-up">
                            <i class="fas fa-shield-alt"></i> +2% vs ÏßÄÎÇúÏ£º
                        </div>
                    </div>
                    <i class="fas fa-vial text-5xl text-indigo-400 opacity-20"></i>
                </div>
            </div>
        </div>

        <!-- V-Model Visualization -->
        <div class="glass-card mb-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold">
                    <i class="fas fa-bezier-curve mr-2"></i>
                    V-Model with Continuous DevOps Loop
                </h2>
                <div>
                    <button class="control-btn active" id="btn-animation" onclick="toggleAnimation()">
                        <i class="fas fa-play"></i> Animation
                    </button>
                    <button class="control-btn" onclick="resetView()">
                        <i class="fas fa-redo"></i> Reset View
                    </button>
                    <button class="control-btn" onclick="highlightSyncPoints()">
                        <i class="fas fa-link"></i> Sync Points
                    </button>
                </div>
            </div>

            <div id="v-model-container"></div>

            <!-- Legend -->
            <div class="mt-4 pt-4 border-t border-gray-700">
                <div class="flex flex-wrap items-center">
                    <div class="legend-item">
                        <div class="legend-line" style="background: linear-gradient(90deg, #002c5f, #1e40af);"></div>
                        <span>System Design (HW)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-line" style="background: linear-gradient(90deg, #10b981, #059669);"></div>
                        <span>Verification (Testing)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-line" style="background: #8b5cf6; border: 2px dashed #8b5cf6; height: 2px;"></div>
                        <span>DevOps Loop (CI/CD)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-line" style="background: #f59e0b; border: 2px dashed #f59e0b; height: 2px;"></div>
                        <span>Sync Point (HW-SW)</span>
                    </div>
                    <div class="legend-item">
                        <div style="width: 16px; height: 16px; border-radius: 50%; background: #fff; margin-right: 10px;"></div>
                        <span>Data Flow</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Details Section -->
        <div class="grid grid-cols-2 gap-6">
            <div class="glass-card">
                <h3 class="text-lg font-semibold mb-4">
                    <i class="fas fa-list-ul mr-2 text-blue-400"></i>
                    V-Model Stage Details
                </h3>
                <div class="space-y-3" id="stage-details">
                    <div class="flex justify-between items-center p-3 bg-white bg-opacity-5 rounded-lg">
                        <div>
                            <div class="font-semibold">Requirements Analysis</div>
                            <div class="text-xs text-gray-400">Í≥†Í∞ù ÏöîÍµ¨ÏÇ¨Ìï≠ Î∂ÑÏÑù Î∞è Backlog ÏÉùÏÑ±</div>
                        </div>
                        <span class="status-badge status-completed">Completed</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-white bg-opacity-5 rounded-lg">
                        <div>
                            <div class="font-semibold">System Design</div>
                            <div class="text-xs text-gray-400">ÏãúÏä§ÌÖú ÏïÑÌÇ§ÌÖçÏ≤ò ÏÑ§Í≥Ñ Î∞è API ÌôïÏ†ï</div>
                        </div>
                        <span class="status-badge status-completed">Completed</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-white bg-opacity-5 rounded-lg">
                        <div>
                            <div class="font-semibold">Detailed Design</div>
                            <div class="text-xs text-gray-400">ÏÉÅÏÑ∏ ÏÑ§Í≥Ñ Î∞è Î™®Îìà Ïù∏ÌÑ∞ÌéòÏù¥Ïä§ Ï†ïÏùò</div>
                        </div>
                        <span class="status-badge status-inprogress">In Progress</span>
                    </div>
                    <div class="flex justify-between items-center p-3 bg-white bg-opacity-5 rounded-lg">
                        <div>
                            <div class="font-semibold">Implementation</div>
                            <div class="text-xs text-gray-400">ÏΩîÎìú Íµ¨ÌòÑ Î∞è Îã®ÏúÑ ÌÖåÏä§Ìä∏</div>
                        </div>
                        <span class="status-badge status-pending">Pending</span>
                    </div>
                </div>
            </div>

            <div class="glass-card">
                <h3 class="text-lg font-semibold mb-4">
                    <i class="fas fa-infinity mr-2 text-purple-400"></i>
                    DevOps Loop Metrics
                </h3>
                <div class="space-y-4">
                    <div class="p-4 bg-white bg-opacity-5 rounded-lg">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm text-gray-400">CI (Continuous Integration)</span>
                            <span class="text-green-400 font-semibold">47 builds/day</span>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-2">
                            <div class="bg-green-400 h-2 rounded-full" style="width: 94%"></div>
                        </div>
                    </div>
                    <div class="p-4 bg-white bg-opacity-5 rounded-lg">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm text-gray-400">CD (Continuous Delivery)</span>
                            <span class="text-blue-400 font-semibold">23 deploys/week</span>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-2">
                            <div class="bg-blue-400 h-2 rounded-full" style="width: 88%"></div>
                        </div>
                    </div>
                    <div class="p-4 bg-white bg-opacity-5 rounded-lg">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm text-gray-400">Test (Continuous Testing)</span>
                            <span class="text-purple-400 font-semibold">89 test runs/day</span>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-2">
                            <div class="bg-purple-400 h-2 rounded-full" style="width: 96%"></div>
                        </div>
                    </div>
                    <div class="p-4 bg-white bg-opacity-5 rounded-lg">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm text-gray-400">Monitor (Continuous Monitoring)</span>
                            <span class="text-yellow-400 font-semibold">2.4M events/day</span>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-2">
                            <div class="bg-yellow-400 h-2 rounded-full" style="width: 99%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tooltip -->
    <div id="tooltip" class="tooltip"></div>

    <script>
        // Data Structure
        const vModelStages = {
            left: [
                { id: 'req', name: 'Requirements', label: 'ÏöîÍµ¨ÏÇ¨Ìï≠ Î∂ÑÏÑù', status: 'completed', duration: '4Ï£º', team: 'Product', color: '#3b82f6' },
                { id: 'sysdes', name: 'System Design', label: 'ÏãúÏä§ÌÖú ÏÑ§Í≥Ñ', status: 'completed', duration: '6Ï£º', team: 'Architecture', color: '#2563eb' },
                { id: 'detdes', name: 'Detailed Design', label: 'ÏÉÅÏÑ∏ ÏÑ§Í≥Ñ', status: 'inprogress', duration: '8Ï£º', team: 'Development', color: '#1e40af' },
                { id: 'moddes', name: 'Module Design', label: 'Î™®Îìà ÏÑ§Í≥Ñ', status: 'pending', duration: '4Ï£º', team: 'Development', color: '#1e3a8a' },
                { id: 'impl', name: 'Implementation', label: 'Íµ¨ÌòÑ', status: 'pending', duration: '12Ï£º', team: 'Development', color: '#002c5f' }
            ],
            right: [
                { id: 'unit', name: 'Unit Testing', label: 'Îã®ÏúÑ ÌÖåÏä§Ìä∏', status: 'pending', duration: '2Ï£º', team: 'QA', color: '#059669' },
                { id: 'integ', name: 'Integration Test', label: 'ÌÜµÌï© ÌÖåÏä§Ìä∏', status: 'pending', duration: '4Ï£º', team: 'QA', color: '#10b981' },
                { id: 'systest', name: 'System Testing', label: 'ÏãúÏä§ÌÖú ÌÖåÏä§Ìä∏', status: 'pending', duration: '6Ï£º', team: 'QA', color: '#34d399' },
                { id: 'accept', name: 'Acceptance Test', label: 'Ïù∏Ïàò ÌÖåÏä§Ìä∏', status: 'pending', duration: '3Ï£º', team: 'Product', color: '#6ee7b7' },
                { id: 'ops', name: 'Operations', label: 'Ïö¥ÏòÅ', status: 'pending', duration: 'ÏßÄÏÜç', team: 'Operations', color: '#a7f3d0' }
            ]
        };

        const devopsLoop = [
            { id: 'ci', name: 'CI', label: 'Build', color: '#8b5cf6', metric: '47 builds/day' },
            { id: 'cd', name: 'CD', label: 'Deploy', color: '#7c3aed', metric: '23 deploys/week' },
            { id: 'test', name: 'Test', label: 'Test', color: '#6d28d9', metric: '89 runs/day' },
            { id: 'monitor', name: 'Monitor', label: 'Monitor', color: '#5b21b6', metric: '2.4M events/day' }
        ];

        const syncPoints = [
            { from: 'sysdes', to: 'ci', label: 'API Freeze', icon: 'üîí' },
            { from: 'detdes', to: 'test', label: 'HIL Test', icon: '‚öôÔ∏è' },
            { from: 'impl', to: 'cd', label: 'Shadow Mode', icon: '‚ö°' },
            { from: 'unit', to: 'monitor', label: 'Golden Build', icon: 'üì°' }
        ];

        // SVG Setup
        const container = d3.select('#v-model-container');
        const width = container.node().getBoundingClientRect().width;
        const height = 700;

        const svg = container.append('svg')
            .attr('width', width)
            .attr('height', height);

        // Define arrow markers
        const defs = svg.append('defs');
        
        defs.append('marker')
            .attr('id', 'arrow-v')
            .attr('viewBox', '0 -5 10 10')
            .attr('refX', 8)
            .attr('refY', 0)
            .attr('markerWidth', 6)
            .attr('markerHeight', 6)
            .attr('orient', 'auto')
            .append('path')
            .attr('d', 'M0,-5L10,0L0,5')
            .attr('fill', '#002c5f');

        defs.append('marker')
            .attr('id', 'arrow-sync')
            .attr('viewBox', '0 -5 10 10')
            .attr('refX', 8)
            .attr('refY', 0)
            .attr('markerWidth', 5)
            .attr('markerHeight', 5)
            .attr('orient', 'auto')
            .append('path')
            .attr('d', 'M0,-5L10,0L0,5')
            .attr('fill', '#f59e0b');

        const g = svg.append('g');

        // Calculate positions
        const leftX = 100;
        const rightX = width - 100;
        const topY = 80;
        const bottomY = height - 80;
        const centerX = width / 2;
        const centerY = height / 2;

        // V-Model Left Path (Bezier Curve)
        const leftPath = d3.path();
        leftPath.moveTo(leftX, topY);
        
        const leftControlX1 = leftX - 50;
        const leftControlX2 = centerX - 150;
        
        for (let i = 0; i < 4; i++) {
            const startY = topY + (i * (bottomY - topY) / 4);
            const endY = topY + ((i + 1) * (bottomY - topY) / 4);
            leftPath.bezierCurveTo(
                leftControlX1, startY + (endY - startY) / 2,
                leftControlX2, startY + (endY - startY) / 2,
                centerX - 100, endY
            );
        }

        g.append('path')
            .attr('d', leftPath.toString())
            .attr('class', 'v-path')
            .attr('marker-end', 'url(#arrow-v)');

        // V-Model Right Path (Bezier Curve)
        const rightPath = d3.path();
        rightPath.moveTo(centerX + 100, bottomY);
        
        const rightControlX1 = centerX + 150;
        const rightControlX2 = rightX + 50;
        
        for (let i = 0; i < 4; i++) {
            const startY = bottomY - (i * (bottomY - topY) / 4);
            const endY = bottomY - ((i + 1) * (bottomY - topY) / 4);
            rightPath.bezierCurveTo(
                rightControlX1, startY - (startY - endY) / 2,
                rightControlX2, startY - (startY - endY) / 2,
                rightX, endY
            );
        }

        g.append('path')
            .attr('d', rightPath.toString())
            .attr('class', 'v-path-right')
            .attr('marker-end', 'url(#arrow-v)');

        // DevOps Infinity Loop (‚àû)
        const loopCenterX = centerX;
        const loopCenterY = centerY;
        const loopRadiusX = 120;
        const loopRadiusY = 80;

        // Lemniscate of Gerono (Infinity shape) parametric equations
        function infinityX(t) {
            return loopCenterX + loopRadiusX * Math.cos(t) / (1 + Math.sin(t) ** 2);
        }

        function infinityY(t) {
            return loopCenterY + loopRadiusY * Math.sin(t) * Math.cos(t) / (1 + Math.sin(t) ** 2);
        }

        const infinityPath = d3.path();
        const steps = 200;
        for (let i = 0; i <= steps; i++) {
            const t = (i / steps) * 2 * Math.PI;
            const x = infinityX(t);
            const y = infinityY(t);
            if (i === 0) {
                infinityPath.moveTo(x, y);
            } else {
                infinityPath.lineTo(x, y);
            }
        }
        infinityPath.closePath();

        g.append('path')
            .attr('d', infinityPath.toString())
            .attr('class', 'devops-loop');

        // Add V-Model Nodes (Left)
        const leftNodes = g.append('g').attr('class', 'left-nodes');
        vModelStages.left.forEach((stage, i) => {
            const y = topY + (i * (bottomY - topY) / (vModelStages.left.length - 1));
            
            const node = leftNodes.append('g')
                .attr('class', 'node-circle')
                .attr('transform', `translate(${leftX}, ${y})`)
                .on('mouseover', (event) => showTooltip(event, stage))
                .on('mouseout', hideTooltip);

            node.append('circle')
                .attr('r', 30)
                .attr('fill', stage.color)
                .attr('stroke', '#fff')
                .attr('stroke-width', 3);

            node.append('text')
                .attr('class', 'node-label')
                .attr('y', 5)
                .text(stage.name.split(' ')[0]);

            node.append('text')
                .attr('class', 'node-sublabel')
                .attr('y', -45)
                .text(stage.label);

            // Status indicator
            const statusColor = stage.status === 'completed' ? '#10b981' : 
                                stage.status === 'inprogress' ? '#3b82f6' : '#6b7280';
            node.append('circle')
                .attr('r', 6)
                .attr('cx', 25)
                .attr('cy', -20)
                .attr('fill', statusColor)
                .attr('stroke', '#fff')
                .attr('stroke-width', 2);
        });

        // Add V-Model Nodes (Right)
        const rightNodes = g.append('g').attr('class', 'right-nodes');
        vModelStages.right.forEach((stage, i) => {
            const y = bottomY - (i * (bottomY - topY) / (vModelStages.right.length - 1));
            
            const node = rightNodes.append('g')
                .attr('class', 'node-circle')
                .attr('transform', `translate(${rightX}, ${y})`)
                .on('mouseover', (event) => showTooltip(event, stage))
                .on('mouseout', hideTooltip);

            node.append('circle')
                .attr('r', 30)
                .attr('fill', stage.color)
                .attr('stroke', '#fff')
                .attr('stroke-width', 3);

            node.append('text')
                .attr('class', 'node-label')
                .attr('y', 5)
                .text(stage.name.split(' ')[0]);

            node.append('text')
                .attr('class', 'node-sublabel')
                .attr('y', -45)
                .text(stage.label);

            // Status indicator
            const statusColor = stage.status === 'completed' ? '#10b981' : 
                                stage.status === 'inprogress' ? '#3b82f6' : '#6b7280';
            node.append('circle')
                .attr('r', 6)
                .attr('cx', 25)
                .attr('cy', -20)
                .attr('fill', statusColor)
                .attr('stroke', '#fff')
                .attr('stroke-width', 2);
        });

        // Add DevOps Loop Nodes
        const loopNodes = g.append('g').attr('class', 'loop-nodes');
        devopsLoop.forEach((stage, i) => {
            const t = (i / devopsLoop.length) * 2 * Math.PI;
            const x = infinityX(t);
            const y = infinityY(t);
            
            const node = loopNodes.append('g')
                .attr('class', 'node-circle')
                .attr('transform', `translate(${x}, ${y})`)
                .on('mouseover', (event) => showLoopTooltip(event, stage))
                .on('mouseout', hideTooltip);

            node.append('circle')
                .attr('r', 25)
                .attr('fill', stage.color)
                .attr('stroke', '#fff')
                .attr('stroke-width', 3);

            node.append('text')
                .attr('class', 'node-label')
                .attr('y', 5)
                .style('font-size', '12px')
                .text(stage.name);

            node.append('text')
                .attr('class', 'node-sublabel')
                .attr('y', -35)
                .text(stage.label);
        });

        // Add Sync Points (initially hidden)
        const syncGroup = g.append('g').attr('class', 'sync-points').style('opacity', 0);
        
        syncPoints.forEach(sync => {
            const fromStage = vModelStages.left.find(s => s.id === sync.from) || 
                              vModelStages.right.find(s => s.id === sync.from);
            const fromIdx = vModelStages.left.findIndex(s => s.id === sync.from);
            const fromIdxRight = vModelStages.right.findIndex(s => s.id === sync.from);
            
            let fromX, fromY;
            if (fromIdx >= 0) {
                fromX = leftX;
                fromY = topY + (fromIdx * (bottomY - topY) / (vModelStages.left.length - 1));
            } else {
                fromX = rightX;
                fromY = bottomY - (fromIdxRight * (bottomY - topY) / (vModelStages.right.length - 1));
            }

            const toIdx = devopsLoop.findIndex(s => s.id === sync.to);
            const t = (toIdx / devopsLoop.length) * 2 * Math.PI;
            const toX = infinityX(t);
            const toY = infinityY(t);

            syncGroup.append('line')
                .attr('class', 'sync-line')
                .attr('x1', fromX)
                .attr('y1', fromY)
                .attr('x2', toX)
                .attr('y2', toY);

            syncGroup.append('circle')
                .attr('class', 'sync-point')
                .attr('cx', (fromX + toX) / 2)
                .attr('cy', (fromY + toY) / 2)
                .attr('r', 8);

            syncGroup.append('text')
                .attr('x', (fromX + toX) / 2)
                .attr('y', (fromY + toY) / 2 - 15)
                .attr('class', 'node-sublabel')
                .style('font-size', '11px')
                .style('fill', '#f59e0b')
                .text(`${sync.icon} ${sync.label}`);
        });

        // Tooltip Functions
        const tooltip = d3.select('#tooltip');

        function showTooltip(event, stage) {
            tooltip.html(`
                <div class="tooltip-title">${stage.label}</div>
                <div class="tooltip-row">
                    <span class="tooltip-label">Status:</span>
                    <span class="tooltip-value">${stage.status.toUpperCase()}</span>
                </div>
                <div class="tooltip-row">
                    <span class="tooltip-label">Duration:</span>
                    <span class="tooltip-value">${stage.duration}</span>
                </div>
                <div class="tooltip-row">
                    <span class="tooltip-label">Team:</span>
                    <span class="tooltip-value">${stage.team}</span>
                </div>
            `)
            .style('display', 'block')
            .style('left', (event.pageX + 20) + 'px')
            .style('top', (event.pageY - 30) + 'px');
        }

        function showLoopTooltip(event, stage) {
            tooltip.html(`
                <div class="tooltip-title">${stage.label}</div>
                <div class="tooltip-row">
                    <span class="tooltip-label">Type:</span>
                    <span class="tooltip-value">DevOps Loop</span>
                </div>
                <div class="tooltip-row">
                    <span class="tooltip-label">Metric:</span>
                    <span class="tooltip-value">${stage.metric}</span>
                </div>
            `)
            .style('display', 'block')
            .style('left', (event.pageX + 20) + 'px')
            .style('top', (event.pageY - 30) + 'px');
        }

        function hideTooltip() {
            tooltip.style('display', 'none');
        }

        // Particle Animation
        let animationEnabled = true;
        let particleInterval;

        function startParticleAnimation() {
            particleInterval = setInterval(() => {
                const particle = g.append('circle')
                    .attr('class', 'particle')
                    .attr('r', 5)
                    .attr('cx', infinityX(0))
                    .attr('cy', infinityY(0));

                particle.transition()
                    .duration(3000)
                    .ease(d3.easeLinear)
                    .tween('pathTween', () => {
                        return (t) => {
                            const angle = t * 2 * Math.PI;
                            particle
                                .attr('cx', infinityX(angle))
                                .attr('cy', infinityY(angle));
                        };
                    })
                    .remove();
            }, 500);
        }

        function stopParticleAnimation() {
            if (particleInterval) {
                clearInterval(particleInterval);
            }
            g.selectAll('.particle').remove();
        }

        // Control Functions
        function toggleAnimation() {
            animationEnabled = !animationEnabled;
            const btn = document.getElementById('btn-animation');
            
            if (animationEnabled) {
                btn.classList.add('active');
                btn.innerHTML = '<i class="fas fa-pause"></i> Pause';
                startParticleAnimation();
            } else {
                btn.classList.remove('active');
                btn.innerHTML = '<i class="fas fa-play"></i> Play';
                stopParticleAnimation();
            }
        }

        function resetView() {
            syncGroup.transition().duration(500).style('opacity', 0);
        }

        function highlightSyncPoints() {
            const currentOpacity = parseFloat(syncGroup.style('opacity'));
            syncGroup.transition()
                .duration(500)
                .style('opacity', currentOpacity === 0 ? 1 : 0);
        }

        // Auto-start animation
        startParticleAnimation();

        // Auto-update timestamp
        setInterval(() => {
            const now = new Date();
            document.getElementById('last-update').textContent = now.toLocaleTimeString('ko-KR');
        }, 1000);
    </script>
</body>
</html>
