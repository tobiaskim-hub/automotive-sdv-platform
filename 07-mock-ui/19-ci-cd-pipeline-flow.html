<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FleetFlag - CI/CD Pipeline Flow</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        :root {
            --primary: #002c5f;
            --secondary: #00aad2;
            --danger: #dc2626;
            --warning: #f59e0b;
            --success: #10b981;
            --purple: #8b5cf6;
            --indigo: #6366f1;
        }

        body {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #f1f5f9;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        #pipeline-container {
            width: 100%;
            height: 650px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 16px;
            position: relative;
            overflow: hidden;
        }

        .section-bg {
            opacity: 0.3;
        }

        .step-badge {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #000;
            border: 3px solid #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            color: #fff;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
        }

        .tool-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            background: #fff;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tool-icon:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 24px rgba(0, 170, 210, 0.5);
        }

        .tool-label {
            font-size: 13px;
            font-weight: 600;
            text-align: center;
            margin-top: 8px;
            text-shadow: 0 0 4px rgba(0, 0, 0, 0.9);
        }

        .arrow-line {
            stroke: #64748b;
            stroke-width: 3;
            fill: none;
            marker-end: url(#arrow);
            opacity: 0.6;
        }

        .arrow-line:hover {
            stroke: #00aad2;
            stroke-width: 4;
            opacity: 1;
        }

        .section-title {
            font-size: 18px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.95);
            color: #fff;
            padding: 16px 20px;
            border-radius: 12px;
            font-size: 13px;
            pointer-events: none;
            z-index: 1000;
            border: 2px solid rgba(0, 170, 210, 0.6);
            display: none;
            max-width: 320px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
        }

        .kpi-value {
            font-size: 32px;
            font-weight: 700;
            line-height: 1;
        }

        .kpi-label {
            font-size: 13px;
            color: #94a3b8;
            margin-top: 4px;
        }

        .kpi-trend {
            font-size: 12px;
            margin-top: 4px;
        }

        .trend-up {
            color: #10b981;
        }

        .description-box {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 11px;
            max-width: 140px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="max-w-[1800px] mx-auto">
        <!-- Header -->
        <div class="glass-card mb-6">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-3xl font-bold mb-2">
                        <i class="fas fa-stream mr-3" style="color: var(--secondary);"></i>
                        CI/CD Pipeline Flow Visualization
                    </h1>
                    <p class="text-gray-400">Code Development → Continuous Integration → Continuous Deployment 전체 흐름도</p>
                </div>
                <div class="text-right">
                    <div class="text-sm text-gray-400">Pipeline Status</div>
                    <div class="text-xl font-semibold text-green-400">
                        <i class="fas fa-check-circle"></i> Active
                    </div>
                </div>
            </div>
        </div>

        <!-- KPI Cards -->
        <div class="grid grid-cols-5 gap-4 mb-6">
            <div class="glass-card">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="kpi-label">일일 빌드</div>
                        <div class="kpi-value text-blue-400">47</div>
                        <div class="kpi-trend trend-up">
                            <i class="fas fa-arrow-up"></i> +8 vs 어제
                        </div>
                    </div>
                    <i class="fas fa-hammer text-5xl text-blue-400 opacity-20"></i>
                </div>
            </div>

            <div class="glass-card">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="kpi-label">평균 빌드 시간</div>
                        <div class="kpi-value text-green-400">8m</div>
                        <div class="kpi-trend trend-up">
                            <i class="fas fa-clock"></i> -2m 단축
                        </div>
                    </div>
                    <i class="fas fa-stopwatch text-5xl text-green-400 opacity-20"></i>
                </div>
            </div>

            <div class="glass-card">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="kpi-label">테스트 성공률</div>
                        <div class="kpi-value text-purple-400">96%</div>
                        <div class="kpi-trend trend-up">
                            <i class="fas fa-check"></i> +2% 증가
                        </div>
                    </div>
                    <i class="fas fa-vial text-5xl text-purple-400 opacity-20"></i>
                </div>
            </div>

            <div class="glass-card">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="kpi-label">주간 배포</div>
                        <div class="kpi-value text-yellow-400">23</div>
                        <div class="kpi-trend text-gray-400">
                            <i class="fas fa-rocket"></i> 안정적
                        </div>
                    </div>
                    <i class="fas fa-cloud-upload-alt text-5xl text-yellow-400 opacity-20"></i>
                </div>
            </div>

            <div class="glass-card">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="kpi-label">배포 성공률</div>
                        <div class="kpi-value text-indigo-400">99%</div>
                        <div class="kpi-trend trend-up">
                            <i class="fas fa-chart-line"></i> 목표 달성
                        </div>
                    </div>
                    <i class="fas fa-server text-5xl text-indigo-400 opacity-20"></i>
                </div>
            </div>
        </div>

        <!-- Pipeline Visualization -->
        <div class="glass-card mb-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold">
                    <i class="fas fa-project-diagram mr-2"></i>
                    9-Step CI/CD Pipeline
                </h2>
                <div class="text-sm text-gray-400">
                    <i class="fas fa-info-circle mr-1"></i>
                    각 단계를 클릭하여 상세 정보 확인
                </div>
            </div>

            <div id="pipeline-container"></div>
        </div>

        <!-- Stage Details -->
        <div class="grid grid-cols-3 gap-6">
            <!-- Code Development -->
            <div class="glass-card" style="background: rgba(243, 244, 246, 0.05);">
                <h3 class="text-lg font-semibold mb-4" style="color: #9ca3af;">
                    <i class="fas fa-code mr-2"></i>
                    Code Development
                </h3>
                <div class="space-y-3">
                    <div class="p-3 bg-white bg-opacity-5 rounded-lg">
                        <div class="font-semibold mb-1">Step 1-2: Code Push & Analysis</div>
                        <div class="text-xs text-gray-400">개발자가 코드를 GitHub에 푸시하고 정적 분석 실행</div>
                        <div class="mt-2 text-sm text-blue-400">
                            <i class="fas fa-chart-bar"></i> 47 commits/day
                        </div>
                    </div>
                </div>
            </div>

            <!-- Continuous Integration -->
            <div class="glass-card" style="background: rgba(209, 250, 229, 0.05);">
                <h3 class="text-lg font-semibold mb-4" style="color: #10b981;">
                    <i class="fas fa-sync-alt mr-2"></i>
                    Continuous Integration
                </h3>
                <div class="space-y-3">
                    <div class="p-3 bg-white bg-opacity-5 rounded-lg">
                        <div class="font-semibold mb-1">Step 3-6: Build & Test</div>
                        <div class="text-xs text-gray-400">Jenkins 빌드, 테스트 실행, JFrog에 아티팩트 저장</div>
                        <div class="mt-2 text-sm text-green-400">
                            <i class="fas fa-check-circle"></i> 96% success rate
                        </div>
                    </div>
                </div>
            </div>

            <!-- Continuous Deployment -->
            <div class="glass-card" style="background: rgba(219, 234, 254, 0.05);">
                <h3 class="text-lg font-semibold mb-4" style="color: #3b82f6;">
                    <i class="fas fa-cloud mr-2"></i>
                    Continuous Deployment
                </h3>
                <div class="space-y-3">
                    <div class="p-3 bg-white bg-opacity-5 rounded-lg">
                        <div class="font-semibold mb-1">Step 7-9: Bake & Deploy</div>
                        <div class="text-xs text-gray-400">Spinnaker로 이미지 생성 및 Kubernetes 클러스터 배포</div>
                        <div class="mt-2 text-sm text-blue-400">
                            <i class="fas fa-rocket"></i> 23 deploys/week
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tooltip -->
    <div id="tooltip" class="tooltip"></div>

    <script>
        // Pipeline Data
        const pipelineStages = [
            // Code Development Section
            {
                id: 1,
                name: 'Code Push',
                description: 'Code Pushed to Github',
                icon: 'fas fa-user-tie',
                color: '#3b82f6',
                x: 120,
                y: 100,
                section: 'dev',
                details: {
                    tool: 'Developer',
                    action: '코드 작성 및 커밋',
                    metric: '47 commits/day',
                    duration: '~5분'
                }
            },
            {
                id: 2,
                name: 'Git Repository',
                description: 'Git Repository (SCM)',
                icon: 'fab fa-github',
                color: '#000',
                x: 120,
                y: 280,
                section: 'dev',
                details: {
                    tool: 'GitHub',
                    action: '코드 저장 및 버전 관리',
                    metric: '5,234 repos',
                    duration: '실시간'
                }
            },
            {
                id: 'static',
                name: 'Static Analysis',
                description: 'Static Code Analysis',
                icon: 'fas fa-search',
                color: '#64748b',
                x: 120,
                y: 460,
                section: 'dev',
                details: {
                    tool: 'SonarQube',
                    action: '정적 코드 분석',
                    metric: '89% coverage',
                    duration: '~3분'
                }
            },

            // Continuous Integration Section
            {
                id: 3,
                name: 'Build Triggers',
                description: 'Build Triggers',
                icon: 'fas fa-play-circle',
                color: '#f59e0b',
                x: 420,
                y: 80,
                section: 'ci',
                details: {
                    tool: 'Jenkins Webhook',
                    action: '빌드 트리거 발동',
                    metric: '자동 트리거',
                    duration: '즉시'
                }
            },
            {
                id: 4,
                name: 'Builds',
                description: 'Performs Builds',
                icon: 'fas fa-cogs',
                color: '#10b981',
                x: 420,
                y: 200,
                section: 'ci',
                details: {
                    tool: 'Jenkins',
                    action: '빌드 수행',
                    metric: '47 builds/day',
                    duration: '~8분'
                }
            },
            {
                id: 5,
                name: 'Testing',
                description: 'Perform Build Tests',
                icon: 'fas fa-vial',
                color: '#8b5cf6',
                x: 420,
                y: 320,
                section: 'ci',
                details: {
                    tool: 'JUnit / Selenium',
                    action: '단위/통합 테스트',
                    metric: '96% pass rate',
                    duration: '~5분'
                }
            },
            {
                id: 6,
                name: 'Artifactory',
                description: 'Store Builds',
                icon: 'fas fa-box',
                color: '#059669',
                x: 420,
                y: 440,
                section: 'ci',
                details: {
                    tool: 'JFrog Artifactory',
                    action: '아티팩트 저장',
                    metric: '2.4TB 저장',
                    duration: '~2분'
                }
            },

            // Continuous Deployment Section
            {
                id: 7,
                name: 'Bake Trigger',
                description: 'Bake Trigger',
                icon: 'fas fa-fire',
                color: '#f59e0b',
                x: 720,
                y: 120,
                section: 'cd',
                details: {
                    tool: 'Spinnaker',
                    action: '이미지 빌드 트리거',
                    metric: '자동 시작',
                    duration: '즉시'
                }
            },
            {
                id: 8,
                name: 'Bake & Publish',
                description: 'Bake and Publish',
                icon: 'fab fa-docker',
                color: '#0ea5e9',
                x: 720,
                y: 260,
                section: 'cd',
                details: {
                    tool: 'Docker / Spinnaker',
                    action: '컨테이너 이미지 생성',
                    metric: '124 images',
                    duration: '~6분'
                }
            },
            {
                id: 9,
                name: 'Deployment',
                description: 'Deployment Testing',
                icon: 'fas fa-rocket',
                color: '#3b82f6',
                x: 720,
                y: 400,
                section: 'cd',
                details: {
                    tool: 'Kubernetes',
                    action: 'Staging → Production 배포',
                    metric: '23 deploys/week',
                    duration: '~10분'
                }
            },
            {
                id: 'cluster',
                name: 'Production',
                description: 'Production Cluster',
                icon: 'fas fa-server',
                color: '#6366f1',
                x: 720,
                y: 540,
                section: 'cd',
                details: {
                    tool: 'Kubernetes Cluster',
                    action: '운영 환경 서비스',
                    metric: '125k vehicles',
                    duration: '24/7'
                }
            }
        ];

        // Arrow Connections
        const connections = [
            { from: 1, to: 2 },
            { from: 2, to: 'static' },
            { from: 2, to: 3 },
            { from: 3, to: 4 },
            { from: 4, to: 5 },
            { from: 5, to: 6 },
            { from: 6, to: 7 },
            { from: 7, to: 8 },
            { from: 8, to: 9 },
            { from: 9, to: 'cluster' }
        ];

        // SVG Setup
        const container = document.getElementById('pipeline-container');
        const width = container.offsetWidth;
        const height = 650;

        const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
        svg.setAttribute('width', width);
        svg.setAttribute('height', height);
        container.appendChild(svg);

        // Define arrow marker
        const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
        const marker = document.createElementNS('http://www.w3.org/2000/svg', 'marker');
        marker.setAttribute('id', 'arrow');
        marker.setAttribute('viewBox', '0 -5 10 10');
        marker.setAttribute('refX', 8);
        marker.setAttribute('refY', 0);
        marker.setAttribute('markerWidth', 6);
        marker.setAttribute('markerHeight', 6);
        marker.setAttribute('orient', 'auto');

        const arrowPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        arrowPath.setAttribute('d', 'M0,-5L10,0L0,5');
        arrowPath.setAttribute('fill', '#64748b');
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.appendChild(defs);

        // Draw Section Backgrounds
        const sections = [
            { x: 0, width: width / 3, fill: '#f3f4f6', label: 'Code Development' },
            { x: width / 3, width: width / 3, fill: '#d1fae5', label: 'Continuous Integration' },
            { x: 2 * width / 3, width: width / 3, fill: '#dbeafe', label: 'Continuous Deployment' }
        ];

        sections.forEach(section => {
            const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            rect.setAttribute('x', section.x);
            rect.setAttribute('y', 0);
            rect.setAttribute('width', section.width);
            rect.setAttribute('height', height);
            rect.setAttribute('fill', section.fill);
            rect.setAttribute('class', 'section-bg');
            svg.appendChild(rect);

            // Section Title
            const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            text.setAttribute('x', section.x + section.width / 2);
            text.setAttribute('y', 30);
            text.setAttribute('text-anchor', 'middle');
            text.setAttribute('class', 'section-title');
            text.setAttribute('fill', '#1f2937');
            text.textContent = section.label;
            svg.appendChild(text);
        });

        // Draw Connections
        connections.forEach(conn => {
            const fromNode = pipelineStages.find(s => s.id === conn.from);
            const toNode = pipelineStages.find(s => s.id === conn.to);

            if (fromNode && toNode) {
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', fromNode.x);
                line.setAttribute('y1', fromNode.y + 40);
                line.setAttribute('x2', toNode.x);
                line.setAttribute('y2', toNode.y - 40);
                line.setAttribute('class', 'arrow-line');
                svg.appendChild(line);
            }
        });

        // Draw Nodes
        const tooltip = document.getElementById('tooltip');

        pipelineStages.forEach((stage, index) => {
            const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            g.setAttribute('transform', `translate(${stage.x}, ${stage.y})`);
            g.style.cursor = 'pointer';

            // Tool Circle
            const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            circle.setAttribute('r', 40);
            circle.setAttribute('fill', '#fff');
            circle.setAttribute('stroke', stage.color);
            circle.setAttribute('stroke-width', 4);
            circle.style.filter = 'drop-shadow(0 4px 8px rgba(0,0,0,0.3))';
            g.appendChild(circle);

            // Icon (using foreignObject for FontAwesome)
            const foreign = document.createElementNS('http://www.w3.org/2000/svg', 'foreignObject');
            foreign.setAttribute('x', -20);
            foreign.setAttribute('y', -20);
            foreign.setAttribute('width', 40);
            foreign.setAttribute('height', 40);

            const iconDiv = document.createElement('div');
            iconDiv.innerHTML = `<i class="${stage.icon}" style="font-size: 32px; color: ${stage.color};"></i>`;
            iconDiv.style.display = 'flex';
            iconDiv.style.alignItems = 'center';
            iconDiv.style.justifyContent = 'center';
            iconDiv.style.width = '100%';
            iconDiv.style.height = '100%';
            foreign.appendChild(iconDiv);
            g.appendChild(foreign);

            // Step Badge
            if (typeof stage.id === 'number') {
                const badge = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                badge.setAttribute('cx', -30);
                badge.setAttribute('cy', -30);
                badge.setAttribute('r', 16);
                badge.setAttribute('fill', '#000');
                badge.setAttribute('stroke', '#fff');
                badge.setAttribute('stroke-width', 3);
                g.appendChild(badge);

                const badgeText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                badgeText.setAttribute('x', -30);
                badgeText.setAttribute('y', -25);
                badgeText.setAttribute('text-anchor', 'middle');
                badgeText.setAttribute('fill', '#fff');
                badgeText.setAttribute('font-size', '14');
                badgeText.setAttribute('font-weight', 'bold');
                badgeText.textContent = stage.id;
                g.appendChild(badgeText);
            }

            // Label
            const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            label.setAttribute('y', 60);
            label.setAttribute('text-anchor', 'middle');
            label.setAttribute('fill', '#fff');
            label.setAttribute('font-size', '13');
            label.setAttribute('font-weight', '600');
            label.textContent = stage.name;
            g.appendChild(label);

            // Description Box
            const descBox = document.createElementNS('http://www.w3.org/2000/svg', 'foreignObject');
            descBox.setAttribute('x', -70);
            descBox.setAttribute('y', 75);
            descBox.setAttribute('width', 140);
            descBox.setAttribute('height', 50);

            const descDiv = document.createElement('div');
            descDiv.className = 'description-box';
            descDiv.textContent = stage.description;
            descBox.appendChild(descDiv);
            g.appendChild(descBox);

            // Hover Events
            g.addEventListener('mouseenter', (e) => {
                circle.setAttribute('stroke-width', 6);
                circle.style.filter = 'drop-shadow(0 8px 16px rgba(0,170,210,0.6))';

                tooltip.innerHTML = `
                    <div style="font-weight: 700; font-size: 15px; color: #00aad2; margin-bottom: 8px;">
                        ${stage.name}
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 4px 0; font-size: 12px;">
                        <span style="color: #94a3b8;">Tool:</span>
                        <span style="color: #fff; font-weight: 600;">${stage.details.tool}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 4px 0; font-size: 12px;">
                        <span style="color: #94a3b8;">Action:</span>
                        <span style="color: #fff; font-weight: 600;">${stage.details.action}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 4px 0; font-size: 12px;">
                        <span style="color: #94a3b8;">Metric:</span>
                        <span style="color: #10b981; font-weight: 600;">${stage.details.metric}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 4px 0; font-size: 12px;">
                        <span style="color: #94a3b8;">Duration:</span>
                        <span style="color: #f59e0b; font-weight: 600;">${stage.details.duration}</span>
                    </div>
                `;
                tooltip.style.display = 'block';
                tooltip.style.left = (e.pageX + 20) + 'px';
                tooltip.style.top = (e.pageY - 20) + 'px';
            });

            g.addEventListener('mouseleave', () => {
                circle.setAttribute('stroke-width', 4);
                circle.style.filter = 'drop-shadow(0 4px 8px rgba(0,0,0,0.3))';
                tooltip.style.display = 'none';
            });

            svg.appendChild(g);
        });
    </script>
</body>
</html>
