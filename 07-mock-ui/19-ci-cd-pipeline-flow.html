<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FleetFlag - CI/CD Pipeline Flow</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        :root {
            --primary: #002c5f;
            --secondary: #00aad2;
            --danger: #dc2626;
            --warning: #f59e0b;
            --success: #10b981;
            --purple: #8b5cf6;
            --indigo: #6366f1;
        }

        body {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #f1f5f9;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        #pipeline-container {
            width: 100%;
            height: 650px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 16px;
            position: relative;
            overflow: hidden;
        }

        .section-bg {
            opacity: 0.3;
        }

        .step-badge {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #000;
            border: 3px solid #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            color: #fff;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
        }

        .tool-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            background: #fff;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tool-icon:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 24px rgba(0, 170, 210, 0.5);
        }

        .tool-label {
            font-size: 13px;
            font-weight: 600;
            text-align: center;
            margin-top: 8px;
            text-shadow: 0 0 4px rgba(0, 0, 0, 0.9);
        }

        .arrow-line {
            stroke: #64748b;
            stroke-width: 3;
            fill: none;
            marker-end: url(#arrow);
            opacity: 0.6;
        }

        .arrow-line:hover {
            stroke: #00aad2;
            stroke-width: 4;
            opacity: 1;
        }

        .section-title {
            font-size: 18px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.95);
            color: #fff;
            padding: 16px 20px;
            border-radius: 12px;
            font-size: 13px;
            pointer-events: none;
            z-index: 1000;
            border: 2px solid rgba(0, 170, 210, 0.6);
            display: none;
            max-width: 320px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
        }

        .kpi-value {
            font-size: 32px;
            font-weight: 700;
            line-height: 1;
        }

        .kpi-label {
            font-size: 13px;
            color: #94a3b8;
            margin-top: 4px;
        }

        .kpi-trend {
            font-size: 12px;
            margin-top: 4px;
        }

        .trend-up {
            color: #10b981;
        }

        .description-box {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 11px;
            max-width: 140px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="max-w-[1800px] mx-auto">
        <!-- Header -->
        <div class="glass-card mb-6">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-3xl font-bold mb-2">
                        <i class="fas fa-stream mr-3" style="color: var(--secondary);"></i>
                        CI/CD Pipeline Flow Visualization
                    </h1>
                    <p class="text-gray-400">Code Development â†’ Continuous Integration â†’ Continuous Deployment ì „ì²´ íë¦„ë„</p>
                </div>
                <div class="text-right">
                    <div class="text-sm text-gray-400">Pipeline Status</div>
                    <div class="text-xl font-semibold text-green-400">
                        <i class="fas fa-check-circle"></i> Active
                    </div>
                </div>
            </div>
        </div>

        <!-- KPI Cards -->
        <div class="grid grid-cols-5 gap-4 mb-6">
            <div class="glass-card">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="kpi-label">ì¼ì¼ ë¹Œë“œ</div>
                        <div class="kpi-value text-blue-400">47</div>
                        <div class="kpi-trend trend-up">
                            <i class="fas fa-arrow-up"></i> +8 vs ì–´ì œ
                        </div>
                    </div>
                    <i class="fas fa-hammer text-5xl text-blue-400 opacity-20"></i>
                </div>
            </div>

            <div class="glass-card">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="kpi-label">í‰ê·  ë¹Œë“œ ì‹œê°„</div>
                        <div class="kpi-value text-green-400">8m</div>
                        <div class="kpi-trend trend-up">
                            <i class="fas fa-clock"></i> -2m ë‹¨ì¶•
                        </div>
                    </div>
                    <i class="fas fa-stopwatch text-5xl text-green-400 opacity-20"></i>
                </div>
            </div>

            <div class="glass-card">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="kpi-label">í…ŒìŠ¤íŠ¸ ì„±ê³µë¥ </div>
                        <div class="kpi-value text-purple-400">96%</div>
                        <div class="kpi-trend trend-up">
                            <i class="fas fa-check"></i> +2% ì¦ê°€
                        </div>
                    </div>
                    <i class="fas fa-vial text-5xl text-purple-400 opacity-20"></i>
                </div>
            </div>

            <div class="glass-card">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="kpi-label">ì£¼ê°„ ë°°í¬</div>
                        <div class="kpi-value text-yellow-400">23</div>
                        <div class="kpi-trend text-gray-400">
                            <i class="fas fa-rocket"></i> ì•ˆì •ì 
                        </div>
                    </div>
                    <i class="fas fa-cloud-upload-alt text-5xl text-yellow-400 opacity-20"></i>
                </div>
            </div>

            <div class="glass-card">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="kpi-label">ë°°í¬ ì„±ê³µë¥ </div>
                        <div class="kpi-value text-indigo-400">99%</div>
                        <div class="kpi-trend trend-up">
                            <i class="fas fa-chart-line"></i> ëª©í‘œ ë‹¬ì„±
                        </div>
                    </div>
                    <i class="fas fa-server text-5xl text-indigo-400 opacity-20"></i>
                </div>
            </div>
        </div>

        <!-- Pipeline Visualization -->
        <div class="glass-card mb-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold">
                    <i class="fas fa-project-diagram mr-2"></i>
                    9-Step CI/CD Pipeline
                    <span class="ml-3 text-sm" id="simulation-status">
                        <i class="fas fa-circle text-green-400 animate-pulse"></i>
                        <span class="text-gray-400">ì‹¤ì‹œê°„ ì‹œë®¬ë ˆì´ì…˜ ì§„í–‰ ì¤‘</span>
                    </span>
                </h2>
                <div class="flex items-center gap-4">
                    <button class="control-btn" id="btn-simulation" onclick="toggleSimulation()">
                        <i class="fas fa-pause"></i> ì‹œë®¬ë ˆì´ì…˜ ì •ì§€
                    </button>
                    <div class="flex items-center gap-2">
                        <span class="text-sm text-gray-400">ì†ë„:</span>
                        <button class="speed-btn" onclick="setSpeed(0.5)">
                            <i class="fas fa-forward"></i> 0.5x
                        </button>
                        <button class="speed-btn active" onclick="setSpeed(1)">
                            <i class="fas fa-play"></i> 1x
                        </button>
                        <button class="speed-btn" onclick="setSpeed(2)">
                            <i class="fas fa-fast-forward"></i> 2x
                        </button>
                        <button class="speed-btn" onclick="setSpeed(5)">
                            <i class="fas fa-rocket"></i> 5x
                        </button>
                    </div>
                    <div class="text-sm text-gray-400">
                        <i class="fas fa-info-circle mr-1"></i>
                        ê° ë‹¨ê³„ë¥¼ í´ë¦­í•˜ì—¬ ìƒì„¸ ì •ë³´ í™•ì¸
                    </div>
                </div>
            </div>

            <div id="pipeline-container"></div>
        </div>

        <!-- Stage Details -->
        <div class="grid grid-cols-3 gap-6">
            <!-- Code Development -->
            <div class="glass-card" style="background: rgba(243, 244, 246, 0.05);">
                <h3 class="text-lg font-semibold mb-4" style="color: #9ca3af;">
                    <i class="fas fa-code mr-2"></i>
                    Code Development
                </h3>
                <div class="space-y-3">
                    <div class="p-3 bg-white bg-opacity-5 rounded-lg">
                        <div class="font-semibold mb-1">Step 1-2: Code Push & Analysis</div>
                        <div class="text-xs text-gray-400">ê°œë°œìê°€ ì½”ë“œë¥¼ GitHubì— í‘¸ì‹œí•˜ê³  ì •ì  ë¶„ì„ ì‹¤í–‰</div>
                        <div class="mt-2 text-sm text-blue-400">
                            <i class="fas fa-chart-bar"></i> 47 commits/day
                        </div>
                    </div>
                </div>
            </div>

            <!-- Continuous Integration -->
            <div class="glass-card" style="background: rgba(209, 250, 229, 0.05);">
                <h3 class="text-lg font-semibold mb-4" style="color: #10b981;">
                    <i class="fas fa-sync-alt mr-2"></i>
                    Continuous Integration
                </h3>
                <div class="space-y-3">
                    <div class="p-3 bg-white bg-opacity-5 rounded-lg">
                        <div class="font-semibold mb-1">Step 3-6: Build & Test</div>
                        <div class="text-xs text-gray-400">Jenkins ë¹Œë“œ, í…ŒìŠ¤íŠ¸ ì‹¤í–‰, JFrogì— ì•„í‹°íŒ©íŠ¸ ì €ì¥</div>
                        <div class="mt-2 text-sm text-green-400">
                            <i class="fas fa-check-circle"></i> 96% success rate
                        </div>
                    </div>
                </div>
            </div>

            <!-- Continuous Deployment -->
            <div class="glass-card" style="background: rgba(219, 234, 254, 0.05);">
                <h3 class="text-lg font-semibold mb-4" style="color: #3b82f6;">
                    <i class="fas fa-cloud mr-2"></i>
                    Continuous Deployment
                </h3>
                <div class="space-y-3">
                    <div class="p-3 bg-white bg-opacity-5 rounded-lg">
                        <div class="font-semibold mb-1">Step 7-9: Bake & Deploy</div>
                        <div class="text-xs text-gray-400">Spinnakerë¡œ ì´ë¯¸ì§€ ìƒì„± ë° Kubernetes í´ëŸ¬ìŠ¤í„° ë°°í¬</div>
                        <div class="mt-2 text-sm text-blue-400">
                            <i class="fas fa-rocket"></i> 23 deploys/week
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Real-time Activity Log -->
        <div class="glass-card mt-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">
                    <i class="fas fa-stream mr-2 text-blue-400"></i>
                    ì‹¤ì‹œê°„ íŒŒì´í”„ë¼ì¸ í™œë™ ë¡œê·¸
                </h3>
                <div class="text-xs text-gray-400">
                    <i class="fas fa-sync-alt mr-1"></i>
                    ìë™ ì—…ë°ì´íŠ¸ (5ì´ˆë§ˆë‹¤)
                </div>
            </div>
            <div class="bg-black bg-opacity-40 rounded-lg p-4 font-mono text-sm" style="height: 300px; overflow-y: auto;" id="activity-log">
                <!-- Real-time logs will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Tooltip -->
    <div id="tooltip" class="tooltip"></div>

    <script>
        // Pipeline Data
        const pipelineStages = [
            // Code Development Section
            {
                id: 1,
                name: 'Code Push',
                description: 'Code Pushed to Github',
                icon: 'fas fa-user-tie',
                color: '#3b82f6',
                x: 120,
                y: 100,
                section: 'dev',
                details: {
                    tool: 'Developer',
                    action: 'ì½”ë“œ ì‘ì„± ë° ì»¤ë°‹',
                    metric: '47 commits/day',
                    duration: '~5ë¶„'
                }
            },
            {
                id: 2,
                name: 'Git Repository',
                description: 'Git Repository (SCM)',
                icon: 'fab fa-github',
                color: '#000',
                x: 120,
                y: 280,
                section: 'dev',
                details: {
                    tool: 'GitHub',
                    action: 'ì½”ë“œ ì €ì¥ ë° ë²„ì „ ê´€ë¦¬',
                    metric: '5,234 repos',
                    duration: 'ì‹¤ì‹œê°„'
                }
            },
            {
                id: 'static',
                name: 'Static Analysis',
                description: 'Static Code Analysis',
                icon: 'fas fa-search',
                color: '#64748b',
                x: 120,
                y: 460,
                section: 'dev',
                details: {
                    tool: 'SonarQube',
                    action: 'ì •ì  ì½”ë“œ ë¶„ì„',
                    metric: '89% coverage',
                    duration: '~3ë¶„'
                }
            },

            // Continuous Integration Section
            {
                id: 3,
                name: 'Build Triggers',
                description: 'Build Triggers',
                icon: 'fas fa-play-circle',
                color: '#f59e0b',
                x: 420,
                y: 80,
                section: 'ci',
                details: {
                    tool: 'Jenkins Webhook',
                    action: 'ë¹Œë“œ íŠ¸ë¦¬ê±° ë°œë™',
                    metric: 'ìë™ íŠ¸ë¦¬ê±°',
                    duration: 'ì¦‰ì‹œ'
                }
            },
            {
                id: 4,
                name: 'Builds',
                description: 'Performs Builds',
                icon: 'fas fa-cogs',
                color: '#10b981',
                x: 420,
                y: 200,
                section: 'ci',
                details: {
                    tool: 'Jenkins',
                    action: 'ë¹Œë“œ ìˆ˜í–‰',
                    metric: '47 builds/day',
                    duration: '~8ë¶„'
                }
            },
            {
                id: 5,
                name: 'Testing',
                description: 'Perform Build Tests',
                icon: 'fas fa-vial',
                color: '#8b5cf6',
                x: 420,
                y: 320,
                section: 'ci',
                details: {
                    tool: 'JUnit / Selenium',
                    action: 'ë‹¨ìœ„/í†µí•© í…ŒìŠ¤íŠ¸',
                    metric: '96% pass rate',
                    duration: '~5ë¶„'
                }
            },
            {
                id: 6,
                name: 'Artifactory',
                description: 'Store Builds',
                icon: 'fas fa-box',
                color: '#059669',
                x: 420,
                y: 440,
                section: 'ci',
                details: {
                    tool: 'JFrog Artifactory',
                    action: 'ì•„í‹°íŒ©íŠ¸ ì €ì¥',
                    metric: '2.4TB ì €ì¥',
                    duration: '~2ë¶„'
                }
            },

            // Continuous Deployment Section
            {
                id: 7,
                name: 'Bake Trigger',
                description: 'Bake Trigger',
                icon: 'fas fa-fire',
                color: '#f59e0b',
                x: 720,
                y: 120,
                section: 'cd',
                details: {
                    tool: 'Spinnaker',
                    action: 'ì´ë¯¸ì§€ ë¹Œë“œ íŠ¸ë¦¬ê±°',
                    metric: 'ìë™ ì‹œì‘',
                    duration: 'ì¦‰ì‹œ'
                }
            },
            {
                id: 8,
                name: 'Bake & Publish',
                description: 'Bake and Publish',
                icon: 'fab fa-docker',
                color: '#0ea5e9',
                x: 720,
                y: 260,
                section: 'cd',
                details: {
                    tool: 'Docker / Spinnaker',
                    action: 'ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ ìƒì„±',
                    metric: '124 images',
                    duration: '~6ë¶„'
                }
            },
            {
                id: 9,
                name: 'Deployment',
                description: 'Deployment Testing',
                icon: 'fas fa-rocket',
                color: '#3b82f6',
                x: 720,
                y: 400,
                section: 'cd',
                details: {
                    tool: 'Kubernetes',
                    action: 'Staging â†’ Production ë°°í¬',
                    metric: '23 deploys/week',
                    duration: '~10ë¶„'
                }
            },
            {
                id: 'cluster',
                name: 'Production',
                description: 'Production Cluster',
                icon: 'fas fa-server',
                color: '#6366f1',
                x: 720,
                y: 540,
                section: 'cd',
                details: {
                    tool: 'Kubernetes Cluster',
                    action: 'ìš´ì˜ í™˜ê²½ ì„œë¹„ìŠ¤',
                    metric: '125k vehicles',
                    duration: '24/7'
                }
            }
        ];

        // Arrow Connections
        const connections = [
            { from: 1, to: 2 },
            { from: 2, to: 'static' },
            { from: 2, to: 3 },
            { from: 3, to: 4 },
            { from: 4, to: 5 },
            { from: 5, to: 6 },
            { from: 6, to: 7 },
            { from: 7, to: 8 },
            { from: 8, to: 9 },
            { from: 9, to: 'cluster' }
        ];

        // SVG Setup
        const container = document.getElementById('pipeline-container');
        const width = container.offsetWidth;
        const height = 650;

        const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
        svg.setAttribute('width', width);
        svg.setAttribute('height', height);
        container.appendChild(svg);

        // Define arrow marker
        const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
        const marker = document.createElementNS('http://www.w3.org/2000/svg', 'marker');
        marker.setAttribute('id', 'arrow');
        marker.setAttribute('viewBox', '0 -5 10 10');
        marker.setAttribute('refX', 8);
        marker.setAttribute('refY', 0);
        marker.setAttribute('markerWidth', 6);
        marker.setAttribute('markerHeight', 6);
        marker.setAttribute('orient', 'auto');

        const arrowPath = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        arrowPath.setAttribute('d', 'M0,-5L10,0L0,5');
        arrowPath.setAttribute('fill', '#64748b');
        marker.appendChild(arrowPath);
        defs.appendChild(marker);
        svg.appendChild(defs);

        // Draw Section Backgrounds
        const sections = [
            { x: 0, width: width / 3, fill: '#f3f4f6', label: 'Code Development' },
            { x: width / 3, width: width / 3, fill: '#d1fae5', label: 'Continuous Integration' },
            { x: 2 * width / 3, width: width / 3, fill: '#dbeafe', label: 'Continuous Deployment' }
        ];

        sections.forEach(section => {
            const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            rect.setAttribute('x', section.x);
            rect.setAttribute('y', 0);
            rect.setAttribute('width', section.width);
            rect.setAttribute('height', height);
            rect.setAttribute('fill', section.fill);
            rect.setAttribute('class', 'section-bg');
            svg.appendChild(rect);

            // Section Title
            const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            text.setAttribute('x', section.x + section.width / 2);
            text.setAttribute('y', 30);
            text.setAttribute('text-anchor', 'middle');
            text.setAttribute('class', 'section-title');
            text.setAttribute('fill', '#1f2937');
            text.textContent = section.label;
            svg.appendChild(text);
        });

        // Draw Connections
        connections.forEach(conn => {
            const fromNode = pipelineStages.find(s => s.id === conn.from);
            const toNode = pipelineStages.find(s => s.id === conn.to);

            if (fromNode && toNode) {
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', fromNode.x);
                line.setAttribute('y1', fromNode.y + 40);
                line.setAttribute('x2', toNode.x);
                line.setAttribute('y2', toNode.y - 40);
                line.setAttribute('class', 'arrow-line');
                svg.appendChild(line);
            }
        });

        // Draw Nodes
        const tooltip = document.getElementById('tooltip');

        pipelineStages.forEach((stage, index) => {
            const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            g.setAttribute('transform', `translate(${stage.x}, ${stage.y})`);
            g.style.cursor = 'pointer';

            // Tool Circle
            const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            circle.setAttribute('r', 40);
            circle.setAttribute('fill', '#fff');
            circle.setAttribute('stroke', stage.color);
            circle.setAttribute('stroke-width', 4);
            circle.style.filter = 'drop-shadow(0 4px 8px rgba(0,0,0,0.3))';
            g.appendChild(circle);

            // Icon (using foreignObject for FontAwesome)
            const foreign = document.createElementNS('http://www.w3.org/2000/svg', 'foreignObject');
            foreign.setAttribute('x', -20);
            foreign.setAttribute('y', -20);
            foreign.setAttribute('width', 40);
            foreign.setAttribute('height', 40);

            const iconDiv = document.createElement('div');
            iconDiv.innerHTML = `<i class="${stage.icon}" style="font-size: 32px; color: ${stage.color};"></i>`;
            iconDiv.style.display = 'flex';
            iconDiv.style.alignItems = 'center';
            iconDiv.style.justifyContent = 'center';
            iconDiv.style.width = '100%';
            iconDiv.style.height = '100%';
            foreign.appendChild(iconDiv);
            g.appendChild(foreign);

            // Step Badge
            if (typeof stage.id === 'number') {
                const badge = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                badge.setAttribute('cx', -30);
                badge.setAttribute('cy', -30);
                badge.setAttribute('r', 16);
                badge.setAttribute('fill', '#000');
                badge.setAttribute('stroke', '#fff');
                badge.setAttribute('stroke-width', 3);
                g.appendChild(badge);

                const badgeText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                badgeText.setAttribute('x', -30);
                badgeText.setAttribute('y', -25);
                badgeText.setAttribute('text-anchor', 'middle');
                badgeText.setAttribute('fill', '#fff');
                badgeText.setAttribute('font-size', '14');
                badgeText.setAttribute('font-weight', 'bold');
                badgeText.textContent = stage.id;
                g.appendChild(badgeText);
            }

            // Label
            const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            label.setAttribute('y', 60);
            label.setAttribute('text-anchor', 'middle');
            label.setAttribute('fill', '#fff');
            label.setAttribute('font-size', '13');
            label.setAttribute('font-weight', '600');
            label.textContent = stage.name;
            g.appendChild(label);

            // Description Box
            const descBox = document.createElementNS('http://www.w3.org/2000/svg', 'foreignObject');
            descBox.setAttribute('x', -70);
            descBox.setAttribute('y', 75);
            descBox.setAttribute('width', 140);
            descBox.setAttribute('height', 50);

            const descDiv = document.createElement('div');
            descDiv.className = 'description-box';
            descDiv.textContent = stage.description;
            descBox.appendChild(descDiv);
            g.appendChild(descBox);

            // Hover Events
            g.addEventListener('mouseenter', (e) => {
                circle.setAttribute('stroke-width', 6);
                circle.style.filter = 'drop-shadow(0 8px 16px rgba(0,170,210,0.6))';

                tooltip.innerHTML = `
                    <div style="font-weight: 700; font-size: 15px; color: #00aad2; margin-bottom: 8px;">
                        ${stage.name}
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 4px 0; font-size: 12px;">
                        <span style="color: #94a3b8;">Tool:</span>
                        <span style="color: #fff; font-weight: 600;">${stage.details.tool}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 4px 0; font-size: 12px;">
                        <span style="color: #94a3b8;">Action:</span>
                        <span style="color: #fff; font-weight: 600;">${stage.details.action}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 4px 0; font-size: 12px;">
                        <span style="color: #94a3b8;">Metric:</span>
                        <span style="color: #10b981; font-weight: 600;">${stage.details.metric}</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin: 4px 0; font-size: 12px;">
                        <span style="color: #94a3b8;">Duration:</span>
                        <span style="color: #f59e0b; font-weight: 600;">${stage.details.duration}</span>
                    </div>
                `;
                tooltip.style.display = 'block';
                tooltip.style.left = (e.pageX + 20) + 'px';
                tooltip.style.top = (e.pageY - 20) + 'px';
            });

            g.addEventListener('mouseleave', () => {
                circle.setAttribute('stroke-width', 4);
                circle.style.filter = 'drop-shadow(0 4px 8px rgba(0,0,0,0.3))';
                tooltip.style.display = 'none';
            });

            svg.appendChild(g);

            // Store node elements for simulation
            stage.element = g;
            stage.circle = circle;
        });

        // Real-time Simulation
        let simulationRunning = true;
        let simulationInterval;
        let simulationSpeed = 1; // Default 1x speed
        const activityLog = document.getElementById('activity-log');

        const logMessages = [
            { step: 1, icon: 'âœ“', color: '#10b981', message: '[Developer] ì½”ë“œ ì»¤ë°‹: feat/ADAS-Level3-improvements' },
            { step: 1, icon: 'â†‘', color: '#3b82f6', message: '[Developer] GitHubì— í‘¸ì‹œ ì™„ë£Œ' },
            { step: 2, icon: 'âš¡', color: '#f59e0b', message: '[GitHub] Webhook íŠ¸ë¦¬ê±° ë°œìƒ' },
            { step: 2, icon: 'ğŸ“Š', color: '#64748b', message: '[SonarQube] ì •ì  ë¶„ì„ ì‹œì‘...' },
            { step: 2, icon: 'âœ“', color: '#10b981', message: '[SonarQube] ì½”ë“œ í’ˆì§ˆ: Aë“±ê¸‰ (89% ì»¤ë²„ë¦¬ì§€)' },
            { step: 3, icon: 'â–¶', color: '#f59e0b', message: '[Jenkins] ë¹Œë“œ #4523 íŠ¸ë¦¬ê±°ë¨' },
            { step: 4, icon: 'âš™', color: '#10b981', message: '[Jenkins] ë¹Œë“œ ì‹œì‘: Maven clean install' },
            { step: 4, icon: 'âš™', color: '#10b981', message: '[Jenkins] ì»´íŒŒì¼ ì™„ë£Œ (327 files)' },
            { step: 5, icon: 'ğŸ§ª', color: '#8b5cf6', message: '[JUnit] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘... (1,247 tests)' },
            { step: 5, icon: 'âœ“', color: '#10b981', message: '[JUnit] í…ŒìŠ¤íŠ¸ í†µê³¼: 1,198/1,247 (96.1%)' },
            { step: 5, icon: 'ğŸ§ª', color: '#8b5cf6', message: '[Selenium] E2E í…ŒìŠ¤íŠ¸ ì‹œì‘...' },
            { step: 5, icon: 'âœ“', color: '#10b981', message: '[Selenium] E2E í…ŒìŠ¤íŠ¸ í†µê³¼: 89/92 (96.7%)' },
            { step: 6, icon: 'ğŸ“¦', color: '#059669', message: '[JFrog] ì•„í‹°íŒ©íŠ¸ ì—…ë¡œë“œ ì¤‘...' },
            { step: 6, icon: 'âœ“', color: '#10b981', message: '[JFrog] ì €ì¥ ì™„ë£Œ: fleetflag-v2.5.3-SNAPSHOT.jar (42.3MB)' },
            { step: 7, icon: 'ğŸ”¥', color: '#f59e0b', message: '[Spinnaker] Bake íŠ¸ë¦¬ê±° í™œì„±í™”' },
            { step: 8, icon: 'ğŸ³', color: '#0ea5e9', message: '[Docker] ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ ë¹Œë“œ ì‹œì‘...' },
            { step: 8, icon: 'ğŸ³', color: '#0ea5e9', message: '[Docker] ì´ë¯¸ì§€ ìƒì„±: fleetflag:v2.5.3-4523' },
            { step: 8, icon: 'âœ“', color: '#10b981', message: '[Docker] ì´ë¯¸ì§€ í‘¸ì‹œ ì™„ë£Œ (Docker Hub)' },
            { step: 9, icon: 'ğŸš€', color: '#3b82f6', message: '[Spinnaker] Staging ë°°í¬ ì‹œì‘...' },
            { step: 9, icon: 'âœ“', color: '#10b981', message: '[K8s Staging] ë°°í¬ ì™„ë£Œ (3 pods healthy)' },
            { step: 9, icon: 'ğŸ§ª', color: '#8b5cf6', message: '[Staging] ìŠ¤ëª¨í¬ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...' },
            { step: 9, icon: 'âœ“', color: '#10b981', message: '[Staging] ìŠ¤ëª¨í¬ í…ŒìŠ¤íŠ¸ í†µê³¼' },
            { step: 9, icon: 'ğŸš€', color: '#3b82f6', message: '[Spinnaker] Production ë°°í¬ ìŠ¹ì¸ ëŒ€ê¸°...' },
            { step: 9, icon: 'âœ“', color: '#10b981', message: '[Approval] ìë™ ìŠ¹ì¸ë¨ (í…ŒìŠ¤íŠ¸ í†µê³¼)' },
            { step: 9, icon: 'ğŸš€', color: '#6366f1', message: '[K8s Production] Rolling Update ì‹œì‘...' },
            { step: 9, icon: 'âœ“', color: '#10b981', message: '[K8s Production] ë°°í¬ ì™„ë£Œ (12 pods, 125k vehicles)' },
            { step: 9, icon: 'ğŸ“Š', color: '#10b981', message: '[Monitoring] ì„±ëŠ¥ ì§€í‘œ ì •ìƒ (P95: 38ms)' }
        ];

        let currentLogIndex = 0;
        let currentStepIndex = 0;

        function addLogMessage(msg) {
            const now = new Date();
            const timestamp = now.toLocaleTimeString('ko-KR');
            
            const logLine = document.createElement('div');
            logLine.style.marginBottom = '4px';
            logLine.style.animation = 'fadeIn 0.3s ease-in';
            logLine.innerHTML = `
                <span style="color: #64748b;">[${timestamp}]</span>
                <span style="color: ${msg.color}; font-weight: bold;">${msg.icon}</span>
                <span style="color: #e2e8f0;">${msg.message}</span>
            `;
            
            activityLog.appendChild(logLine);
            activityLog.scrollTop = activityLog.scrollHeight;

            // Highlight corresponding stage
            if (msg.step && msg.step <= pipelineStages.length) {
                const stage = pipelineStages.find(s => s.id === msg.step);
                if (stage && stage.circle) {
                    // Pulse effect
                    stage.circle.style.animation = 'pulse 0.5s ease-in-out';
                    setTimeout(() => {
                        stage.circle.style.animation = '';
                    }, 500);
                }
            }

            // Keep only last 50 logs
            if (activityLog.children.length > 50) {
                activityLog.removeChild(activityLog.firstChild);
            }
        }

        function simulateActivity() {
            if (!simulationRunning) return;

            // Add next log message
            if (currentLogIndex < logMessages.length) {
                addLogMessage(logMessages[currentLogIndex]);
                currentLogIndex++;
            } else {
                // Loop back
                currentLogIndex = 0;
                
                // Add separator
                const separator = document.createElement('div');
                separator.style.borderTop = '1px dashed #64748b';
                separator.style.margin = '8px 0';
                activityLog.appendChild(separator);
            }
        }

        function toggleSimulation() {
            simulationRunning = !simulationRunning;
            const btn = document.getElementById('btn-simulation');
            const status = document.getElementById('simulation-status');
            
            if (simulationRunning) {
                btn.innerHTML = '<i class="fas fa-pause"></i> ì‹œë®¬ë ˆì´ì…˜ ì •ì§€';
                status.innerHTML = '<i class="fas fa-circle text-green-400 animate-pulse"></i><span class="text-gray-400">ì‹¤ì‹œê°„ ì‹œë®¬ë ˆì´ì…˜ ì§„í–‰ ì¤‘</span>';
                startSimulation();
            } else {
                btn.innerHTML = '<i class="fas fa-play"></i> ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘';
                status.innerHTML = '<i class="fas fa-circle text-gray-400"></i><span class="text-gray-400">ì‹œë®¬ë ˆì´ì…˜ ì •ì§€ë¨</span>';
                if (simulationInterval) {
                    clearInterval(simulationInterval);
                }
            }
        }

        function startSimulation() {
            if (simulationInterval) {
                clearInterval(simulationInterval);
            }
            const baseInterval = 2000; // Base 2 seconds
            const interval = baseInterval / simulationSpeed;
            simulationInterval = setInterval(simulateActivity, interval);
        }

        function setSpeed(speed) {
            simulationSpeed = speed;
            
            // Update active button
            document.querySelectorAll('.speed-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.closest('.speed-btn').classList.add('active');
            
            // Restart simulation with new speed
            if (simulationRunning) {
                startSimulation();
            }
            
            // Update status text
            const status = document.getElementById('simulation-status');
            if (simulationRunning) {
                status.innerHTML = `<i class="fas fa-circle text-green-400 animate-pulse"></i><span class="text-gray-400">ì‹¤ì‹œê°„ ì‹œë®¬ë ˆì´ì…˜ ì§„í–‰ ì¤‘ (${speed}x ì†ë„)</span>`;
            }
        }

        // Auto-update KPI values
        function updateKPIValues() {
            const dailyBuilds = document.querySelector('.kpi-value.text-blue-400');
            const buildTime = document.querySelector('.kpi-value.text-green-400');
            const testRate = document.querySelector('.kpi-value.text-purple-400');
            const weeklyDeploys = document.querySelector('.kpi-value.text-yellow-400');
            const deployRate = document.querySelector('.kpi-value.text-indigo-400');

            // Simulate slight variations
            if (dailyBuilds) {
                const current = parseInt(dailyBuilds.textContent);
                dailyBuilds.textContent = current + (Math.random() > 0.5 ? 1 : 0);
            }

            if (testRate) {
                const rates = ['95%', '96%', '97%', '96%'];
                testRate.textContent = rates[Math.floor(Math.random() * rates.length)];
            }
        }

        // Initialize simulation
        startSimulation();

        // Update KPIs every 10 seconds
        setInterval(updateKPIValues, 10000);

        // Add CSS animation for fadeIn
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeIn {
                from { opacity: 0; transform: translateX(-10px); }
                to { opacity: 1; transform: translateX(0); }
            }
            @keyframes pulse {
                0%, 100% { transform: scale(1); }
                50% { transform: scale(1.1); }
            }
            .control-btn {
                background: rgba(0, 170, 210, 0.2);
                border: 1px solid rgba(0, 170, 210, 0.5);
                padding: 10px 18px;
                border-radius: 10px;
                color: #00aad2;
                font-size: 14px;
                cursor: pointer;
                transition: all 0.3s ease;
            }
            .control-btn:hover {
                background: rgba(0, 170, 210, 0.4);
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(0, 170, 210, 0.3);
            }
            .speed-btn {
                background: rgba(100, 116, 139, 0.2);
                border: 1px solid rgba(100, 116, 139, 0.5);
                padding: 6px 12px;
                border-radius: 8px;
                color: #94a3b8;
                font-size: 12px;
                cursor: pointer;
                transition: all 0.3s ease;
            }
            .speed-btn:hover {
                background: rgba(100, 116, 139, 0.4);
                color: #e2e8f0;
            }
            .speed-btn.active {
                background: rgba(0, 170, 210, 0.4);
                border-color: #00aad2;
                color: #00aad2;
                font-weight: bold;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
